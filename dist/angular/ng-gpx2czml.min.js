!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(e){"use strict";return e.module("ngGpx2czml",[]).service("gpx2czml",["$q","$http",function(e,t){return{async:function(e,t){function n(){4===a.readyState&&(200===a.status?r.parseGpx(a.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var a,r=this;window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=n,a.open("GET",e),a.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,a){e?"function"==typeof t&&t(e,a):n.parseGpx(a,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,a="chrome";try{var r=e.target.files;if(n.onload=function(e){var r;e?r=e.target.result:(r=n.content,a="ie"),"function"==typeof t&&t(!1,r)},!(r.length>0))throw"file is not defined";n.readAsText(r[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,a;try{window.DOMParser?(n=new DOMParser,a=n.parseFromString(e,"text/xml")):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(e));var r=a.getElementsByTagName("gpx")[0];this.parseXml(r)}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseXml:function(e){console.log(e)},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this;try{for(var a,r,o,i=(e.getElementsByTagName("metadata")[0],e.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=s.getElementsByTagName("trkpt"),g=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:a,multiplier:1,range:"CLAMPED"}},{position:{epoch:a,cartographicDegrees:[]}}],l=0;l<c.length;l++){var p=c[l],u=parseFloat(p.getAttribute("lat")),f=parseFloat(p.getAttribute("lon")),m=n.getTextTag(p.getElementsByTagName("ele")[0]),y=n.getTextTag(p.getElementsByTagName("time")[0]),h=new Date(y).getTime(),T=0==l?0:(h-r)/1e3;if(0===l&&(a=y,r=h),m)o=parseFloat(m);else for(var v=c[l+1],d=v?n.getTextTag(v.getElementsByTagName("ele")[0]):null,x=0;x<c.length;x++){var w=c[x],F=n.getTextTag(w.getElementsByTagName("ele")[0]);if(F){o=parseFloat(F);break}}g[1].position.cartographicDegrees.push(T),g[1].position.cartographicDegrees.push(f),g[1].position.cartographicDegrees.push(u),g[1].position.cartographicDegrees.push(m?parseFloat(m):d?(o+parseFloat(d))/2:o),l==c.length-1&&(g[0].clock.interval=a+"/"+y,g[1].availability=a+"/"+y)}"function"==typeof t&&t(!1,g)}catch(e){"function"==typeof t&&t(!0,e.toString())}}}}])});