!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(e){"use strict";return e.module("ngGpx2czml",[]).service("gpx2czml",["$q","$http",function(e,t){return{async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(e,n){"function"==typeof t&&t(e,n)})}catch(e){"function"==typeof t&&t(!0,e.toString())}},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this;try{for(var r=e.getElementsByTagName("metadata")[0],a=r.getElementsByTagName("time")[0],i=e.getElementsByTagName("trk")[0],o=i.getElementsByTagName("trkseg")[0],s=o.getElementsByTagName("trkpt"),c=this.getTextTag(a),g=new Date(c).getTime(),u=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:c,multiplier:1,range:"CLAMPED"}},{position:{cartographicDegrees:[]}}],p=0;p<s.length;p++){var f=s[p],l=parseFloat(f.getAttribute("lat")),m=parseFloat(f.getAttribute("lon")),y=parseFloat(n.getTextTag(f.getElementsByTagName("ele")[0])),T=n.getTextTag(f.getElementsByTagName("time")[0]),h=(n.getTextTag(f.getElementsByTagName("extensions")[0]),new Date(T).getTime()),d=(h-g)/1e3;u[1].position.cartographicDegrees.push(d),u[1].position.cartographicDegrees.push(l),u[1].position.cartographicDegrees.push(m),u[1].position.cartographicDegrees.push(y),p==s.length-1&&(u[0].clock.interval=c+"/"+T)}"function"==typeof t&&t(!1,u)}catch(e){"function"==typeof t&&t(!0,e.toString())}}}}])});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLWdweDJjem1sLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJhbmd1bGFyIiwidGhpcyIsInNlcnZpY2UiLCIkcSIsIiRodHRwIiwiYXN5bmMiLCJ1cmwiLCJjYkZ1bmMiLCJnZXRHcHhEYXRhIiwiaHR0cFJlcXVlc3QiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwic2VsZiIsInBhcnNlR3B4IiwicmVzcG9uc2VUZXh0IiwiaXNFcnJvciIsInJlcyIsIndpbmRvdyIsIlhNTEh0dHBSZXF1ZXN0IiwiQWN0aXZlWE9iamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIm9wZW4iLCJzZW5kIiwiYXN5bmNGcm9tRmlsZSIsImZpbGVzIiwicHJvY2Vzc2luZ0ZpbGVzIiwiY3ptbEVycm9yIiwiY3ptbFJlcyIsImUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwiYnJvd3NlciIsInRhcmdldCIsIm9ubG9hZCIsImRhdGEiLCJyZXN1bHQiLCJjb250ZW50IiwibGVuZ3RoIiwicmVhZEFzVGV4dCIsInRvU3RyaW5nIiwidG1wIiwieG1sIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwibG9hZFhNTCIsImdweE5vZGUiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImJpbmRDem1sRGF0YSIsImN6bWxEYXRhIiwiZ2V0VGV4dFRhZyIsInRhZyIsInRhZ1N0ciIsInRleHRDb250ZW50IiwicmVwbGFjZSIsIm1ldGFEYXRhIiwidGltZURhdGEiLCJ0cmtDb250ZW50IiwidHJrU2VnIiwidHJrUHRzIiwic3RhcnRUaW1lIiwic3RhcnRTZWNvbmRzIiwiRGF0ZSIsImdldFRpbWUiLCJuYW1lIiwiZ2V0QXR0cmlidXRlIiwidmVyc2lvbiIsImNsb2NrIiwiaW50ZXJ2YWwiLCJjdXJyZW50VGltZSIsIm11bHRpcGxpZXIiLCJyYW5nZSIsInBvc2l0aW9uIiwiY2FydG9ncmFwaGljRGVncmVlcyIsImlkeCIsInRya0luZm8iLCJsYXQiLCJwYXJzZUZsb2F0IiwibG9uIiwiZWxlIiwidGltZSIsInRhcmdldFNlY29uZHMiLCJkZWZmU2Vjb25kcyIsInB1c2giXSwibWFwcGluZ3MiOiJDQUFDLFNBQVVBLEVBQU1DLEdBQ2QsWUFHc0IsbUJBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsUUFBUSxXQUFZRCxHQUNRLGdCQUFaRyxTQUNoQkMsT0FBT0QsUUFBVUgsRUFBUUssUUFBUSxZQUVqQ0wsRUFBUUQsRUFBS08sVUFFZkMsS0FBTSxTQUFVRCxHQUNoQixZQU9BLE9BQU9BLEdBQVFGLE9BQU8saUJBTW5CSSxRQUFRLFlBQUEsS0FBQSxRQUFBLFNBQUFDLEVBQUFDLEdBbU1QLE9Bak1FQyxNQUFRLFNBQVVDLEVBQUtDLEdBY3JCLFFBQVNDLEtBQ3dCLElBQTNCQyxFQUFZQyxhQUNhLE1BQXZCRCxFQUFZRSxPQUNkQyxFQUFLQyxTQUFTSixFQUFZSyxhQUFjLFNBQVVDLEVBQVNDLEdBQ3RDLGtCQUFWVCxJQUF3QkEsRUFBT1EsRUFBU0MsS0FHbEMsa0JBQVZULElBQXdCQSxHQUFPLEVBQU0sdUJBcEJsRCxHQUFJRSxHQUNBRyxFQUFPWCxJQUVQZ0IsUUFBT0MsZUFDVFQsRUFBYyxHQUFJUyxnQkFDVEQsT0FBT0UsZ0JBQ2hCVixFQUFjLEdBQUlVLGVBQWMsc0JBR2xDVixFQUFZVyxtQkFBcUJaLEVBQ2pDQyxFQUFZWSxLQUFLLE1BQU9mLEdBQ3hCRyxFQUFZYSxRQWtCZEMsY0FBZ0IsU0FBVUMsRUFBT2pCLEdBQy9CLEdBQUlLLEdBQU9YLElBRVhBLE1BQUt3QixnQkFBZ0JELEVBQU8sU0FBVVQsRUFBU0MsR0FFekNELEVBQ2Usa0JBQVZSLElBQXdCQSxFQUFPUSxFQUFTQyxHQUUvQ0osRUFBS0MsU0FBU0csRUFBSyxTQUFVVSxFQUFXQyxHQUNyQixrQkFBVnBCLElBQXdCQSxFQUFPbUIsRUFBV0MsUUFVekRGLGdCQUFrQixTQUFVRyxFQUFHckIsR0FDN0IsR0FDSXNCLEdBQVMsR0FBSUMsWUFDYkMsRUFBVSxRQUVkLEtBQ0UsR0FBSVAsR0FBUUksRUFBRUksT0FBT1IsS0FlckIsSUFiQUssRUFBT0ksT0FBUyxTQUFVTCxHQUN4QixHQUFJTSxFQUNDTixHQUlITSxFQUFPTixFQUFFSSxPQUFPRyxRQUhoQkQsRUFBT0wsRUFBT08sUUFDZEwsRUFBVSxNQUtLLGtCQUFWeEIsSUFBd0JBLEdBQU8sRUFBTzJCLE1BSTNDVixFQUFNYSxPQUFTLEdBR2pCLEtBQU0scUJBRk5SLEdBQU9TLFdBQVdkLEVBQU0sR0FBSSxTQU85QixNQUFPSSxHQUNVLGtCQUFWckIsSUFBd0JBLEdBQU8sRUFBTXFCLEVBQUVXLGNBV2xEMUIsU0FBVyxTQUFVcUIsRUFBTTNCLEdBQ3pCLEdBQUlpQyxHQUFJQyxDQUVSLEtBRU14QixPQUFPeUIsV0FDVEYsRUFBTSxHQUFJRSxXQUNWRCxFQUFNRCxFQUFJRyxnQkFBaUJULEVBQU0sY0FFakNPLEVBQU0sR0FBSXRCLGVBQWMsb0JBQ3hCc0IsRUFBSXBDLE1BQVEsUUFDWm9DLEVBQUlHLFFBQVFWLEdBSWQsSUFBSVcsR0FBVUosRUFBSUsscUJBQXFCLE9BQU8sRUFHOUM3QyxNQUFLOEMsYUFBYUYsRUFBUyxTQUFVOUIsRUFBU2lDLEdBQzNCLGtCQUFWekMsSUFBd0JBLEVBQU9RLEVBQVNpQyxLQUVqRCxNQUFPcEIsR0FDVSxrQkFBVnJCLElBQXdCQSxHQUFPLEVBQU1xQixFQUFFVyxjQVNsRFUsV0FBYSxTQUFVQyxHQUVyQixHQUFJQyxHQUFTRCxFQUFJRSxXQUdqQixPQUZBRCxHQUFPRSxRQUFRLGtCQUFtQixJQUUzQkYsR0FRVEosYUFBZSxTQUFVRixFQUFTdEMsR0FDaEMsR0FBSUssR0FBT1gsSUFFWCxLQTZCRSxJQUFJLEdBM0JBcUQsR0FBV1QsRUFBUUMscUJBQXFCLFlBQVksR0FDcERTLEVBQVdELEVBQVNSLHFCQUFxQixRQUFRLEdBQ2pEVSxFQUFhWCxFQUFRQyxxQkFBcUIsT0FBTyxHQUNqRFcsRUFBU0QsRUFBV1YscUJBQXFCLFVBQVUsR0FDbkRZLEVBQVNELEVBQU9YLHFCQUFxQixTQUdyQ2EsRUFBWTFELEtBQUtnRCxXQUFXTSxHQUM1QkssRUFBZSxHQUFJQyxNQUFLRixHQUFXRyxVQUduQ2QsSUFDRmUsS0FBT2xCLEVBQVFtQixhQUFhLFdBQzVCQyxRQUFVcEIsRUFBUW1CLGFBQWEsV0FDL0JFLE9BQ0VDLFNBQVcsS0FDWEMsWUFBY1QsRUFDZFUsV0FBYSxFQUNiQyxNQUFRLGFBR1ZDLFVBQ0VDLDBCQUtJQyxFQUFJLEVBQUdBLEVBQU1mLEVBQU9yQixPQUFRb0MsSUFBTyxDQUN6QyxHQUFJQyxHQUFVaEIsRUFBT2UsR0FDakJFLEVBQU1DLFdBQVdGLEVBQVFWLGFBQWEsUUFDdENhLEVBQU1ELFdBQVdGLEVBQVFWLGFBQWEsUUFDdENjLEVBQU1GLFdBQVdoRSxFQUFLcUMsV0FBV3lCLEVBQVE1QixxQkFBcUIsT0FBTyxLQUNyRWlDLEVBQU9uRSxFQUFLcUMsV0FBV3lCLEVBQVE1QixxQkFBcUIsUUFBUSxJQUU1RGtDLEdBRGFwRSxFQUFLcUMsV0FBV3lCLEVBQVE1QixxQkFBcUIsY0FBYyxJQUN4RCxHQUFJZSxNQUFLa0IsR0FBTWpCLFdBQy9CbUIsR0FBZUQsRUFBZ0JwQixHQUFnQixHQUVuRFosR0FBUyxHQUFHdUIsU0FBU0Msb0JBQW9CVSxLQUFLRCxHQUM5Q2pDLEVBQVMsR0FBR3VCLFNBQVNDLG9CQUFvQlUsS0FBS1AsR0FDOUMzQixFQUFTLEdBQUd1QixTQUFTQyxvQkFBb0JVLEtBQUtMLEdBQzlDN0IsRUFBUyxHQUFHdUIsU0FBU0Msb0JBQW9CVSxLQUFLSixHQUUxQ0wsR0FBUWYsRUFBT3JCLE9BQVEsSUFDekJXLEVBQVMsR0FBR2tCLE1BQU1DLFNBQVdSLEVBQVksSUFBTW9CLEdBSWxDLGtCQUFWeEUsSUFBd0JBLEdBQU8sRUFBT3lDLEdBQzdDLE1BQU9wQixHQUNVLGtCQUFWckIsSUFBd0JBLEdBQU8sRUFBTXFCLEVBQUVXIiwiZmlsZSI6Im5nLWdweDJjem1sLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAvL0FNRCBtb2RlXG4gICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgIGRlZmluZShbJ2FuZ3VsYXInXSwgZmFjdG9yeSk7XG4gICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnYW5ndWxhcicpKTtcbiAgIH0gZWxzZSB7XG4gICAgIGZhY3Rvcnkocm9vdC5hbmd1bGFyKTtcbiAgIH1cbiB9KHRoaXMsIGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAndXNlIHN0cmljdCc7XG5cbiAgIC8qKlxuICAgICogZ3B4MmN6bWwgQW5ndWxhciAxLjAgbW9kdWxlXG4gICAgKiBAbW9kdWxlIG5nR3B4MmN6bWxcbiAgICAqIEBuYW1lIG5nR3B4MmN6bWxcbiAgICAqL1xuICAgcmV0dXJuIGFuZ3VsYXIubW9kdWxlKCduZ0dweDJjem1sJywgW10pXG4gICAgICAvKipcbiAgICAgICAqIGdweDJjem1sIHNlcnZpY2VcbiAgICAgICAqIEBuYW1lIGdweDJjem1sXG4gICAgICAgKiBAbmdkb2Mgc2VydmljZVxuICAgICAgICovXG4gICAgIC5zZXJ2aWNlKCdncHgyY3ptbCcsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcbiAgICAgICB2YXIgZ3B4MmN6bWwgPSB7XG4gICAgICAgICBhc3luYyA6IGZ1bmN0aW9uICh1cmwsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgaHR0cFJlcXVlc3Q7XG4gICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgaHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkge1xuICAgICAgICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MSFRUUFwiKTtcbiAgICAgICAgICAgfVxuXG4gICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGdldEdweERhdGE7XG4gICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICAgICAgIGh0dHBSZXF1ZXN0LnNlbmQoKTtcblxuICAgICAgICAgICBmdW5jdGlvbiBnZXRHcHhEYXRhKCkge1xuICAgICAgICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgc2VsZi5wYXJzZUdweChodHRwUmVxdWVzdC5yZXNwb25zZVRleHQsIGZ1bmN0aW9uIChpc0Vycm9yLCByZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCAnaHR0cCByZXF1ZXN0IGVycm9yJyk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICB9XG4gICAgICAgICB9LFxuICAgICAgICAgLyoqXG4gICAgICAgICAgKiBncHggZmlsZSB1cGxvYWQg7ZSE66Gc7IS47IuxIOyymOumrChhc3luYylcbiAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgICAgICAqL1xuICAgICAgICAgYXN5bmNGcm9tRmlsZSA6IGZ1bmN0aW9uIChmaWxlcywgY2JGdW5jKSB7XG4gICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcyhmaWxlcywgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuXG4gICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICBzZWxmLnBhcnNlR3B4KHJlcywgZnVuY3Rpb24gKGN6bWxFcnJvciwgY3ptbFJlcykge1xuICAgICAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoY3ptbEVycm9yLCBjem1sUmVzKTtcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfSk7XG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGdweCBmaWxlIG9iamVjdCDtlITroZzshLjsi7Eg7LKY66asXG4gICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbGVzIGZpbGUgT2JqZWN0XG4gICAgICAgICAgKi9cbiAgICAgICAgIHByb2Nlc3NpbmdGaWxlcyA6IGZ1bmN0aW9uIChlLCBjYkZ1bmMpIHtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgdmFyIGJyb3dzZXIgPSAnY2hyb21lJztcblxuICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuXG4gICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgICAgICBkYXRhID0gcmVhZGVyLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnaWUnO1xuICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBkYXRhKTtcbiAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlc1swXSwgJ1VURi04Jyk7XG4gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgIHRocm93IFwiZmlsZSBpcyBub3QgZGVmaW5lZFwiO1xuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIC8vZmlsZeydhCDsnb3qsowg7ZWc64ukLlxuICAgICAgICAgICAgIC8vcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlc1swXSk7XG4gICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgfVxuXG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIHBhcnNpbmcgZ3B4IGRhdGFcbiAgICAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gZGF0YSBwZ3ggc3RyaW5nIGRhdGFcbiAgICAgICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYkZ1bmMgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gY3ptbERhdGEgY29udmVydCBjem1sIG9iamVjdCBkYXRhXG4gICAgICAgICAgKi9cbiAgICAgICAgIHBhcnNlR3B4IDogZnVuY3Rpb24gKGRhdGEsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgdG1wLHhtbDtcblxuICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgIC8vaWYgRE9NUGFyc2VyIGlzIGV4aXN0XG4gICAgICAgICAgICAgaWYgKHdpbmRvdy5ET01QYXJzZXIpIHtcbiAgICAgICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICAgICAgIHhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEsIFwidGV4dC94bWxcIiApO1xuICAgICAgICAgICAgIH0gZWxzZSB7ICAvL0lFIHZlcnNpb25cbiAgICAgICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcbiAgICAgICAgICAgICAgIHhtbC5hc3luYyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgIHhtbC5sb2FkWE1MKGRhdGEpO1xuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIC8vZ2V0IGdweCBub2RlIGZyb20geG1sIGRhdGFcbiAgICAgICAgICAgICB2YXIgZ3B4Tm9kZSA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZ3B4JylbMF07XG5cbiAgICAgICAgICAgICAvL2JpbmQgY3ptbGRhdGFcbiAgICAgICAgICAgICB0aGlzLmJpbmRDem1sRGF0YShncHhOb2RlLCBmdW5jdGlvbiAoaXNFcnJvciwgY3ptbERhdGEpIHtcbiAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCBjem1sRGF0YSk7XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgfVxuICAgICAgICAgfSxcblxuICAgICAgICAgLyoqXG4gICAgICAgICAgKiBnZXQgdGV4dCBmcm9tIHRhZ1xuICAgICAgICAgICogQHBhcmFtICB7U3RyaW5nfSB0YWcgdGFnIHN0cmluZ1xuICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSB0YWdTdHIgdGFnIHN0cmluZ1xuICAgICAgICAgICovXG4gICAgICAgICBnZXRUZXh0VGFnIDogZnVuY3Rpb24gKHRhZykge1xuICAgICAgICAgICAvL3ZhciB0YWdTdHIgPSB0YWcuaW5uZXJIVE1MLnJlcGxhY2UoLzxbXj5dKj4vZywgXCJcIik7XG4gICAgICAgICAgIHZhciB0YWdTdHIgPSB0YWcudGV4dENvbnRlbnQ7XG4gICAgICAgICAgIHRhZ1N0ci5yZXBsYWNlKC8oXlxccyopfChcXHMqJCkvZ2ksIFwiXCIpO1xuXG4gICAgICAgICAgIHJldHVybiB0YWdTdHI7XG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGN6bWwgZGF0YSBiaW5kaW5nXG4gICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGdweE5vZGUgZ3B4IHhtbCBkb20gbm9kZVxuICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjem1sIG9iamVjdCBkYXRhXG4gICAgICAgICAgKi9cbiAgICAgICAgIGJpbmRDem1sRGF0YSA6IGZ1bmN0aW9uIChncHhOb2RlLCBjYkZ1bmMpIHtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgLy94bWwgcGFyc2luZ1xuICAgICAgICAgICAgIHZhciBtZXRhRGF0YSA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGFkYXRhJylbMF0sIC8vbWV0YWRhdGFcbiAgICAgICAgICAgICAgICAgdGltZURhdGEgPSBtZXRhRGF0YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGltZScpWzBdLCAgLy90aW1lXG4gICAgICAgICAgICAgICAgIHRya0NvbnRlbnQgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmsnKVswXSwgIC8vdHJhY2tpbmcgZGF0YVxuICAgICAgICAgICAgICAgICB0cmtTZWcgPSB0cmtDb250ZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtzZWcnKVswXSwgIC8vdHJrc2VnXG4gICAgICAgICAgICAgICAgIHRya1B0cyA9IHRya1NlZy5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHJrcHQnKTsgIC8vdHJhY2tpbmcgcG9pbnQgYXJyYXlzXG5cbiAgICAgICAgICAgICAvL2dldCBzdGFydCB0aW1lXG4gICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IHRoaXMuZ2V0VGV4dFRhZyh0aW1lRGF0YSksXG4gICAgICAgICAgICAgICAgIHN0YXJ0U2Vjb25kcyA9IG5ldyBEYXRlKHN0YXJ0VGltZSkuZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICAgLy9iaW5kaW5nIHRhcmdldFxuICAgICAgICAgICAgIHZhciBjem1sRGF0YSA9IFt7XG4gICAgICAgICAgICAgICBuYW1lIDogZ3B4Tm9kZS5nZXRBdHRyaWJ1dGUoJ2NyZWF0b3InKSxcbiAgICAgICAgICAgICAgIHZlcnNpb24gOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgndmVyc2lvbicpLFxuICAgICAgICAgICAgICAgY2xvY2sgOiB7XG4gICAgICAgICAgICAgICAgIGludGVydmFsIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgY3VycmVudFRpbWUgOiBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgOiAxLFxuICAgICAgICAgICAgICAgICByYW5nZSA6ICdDTEFNUEVEJ1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgIHBvc2l0aW9uIDoge1xuICAgICAgICAgICAgICAgICBjYXJ0b2dyYXBoaWNEZWdyZWVzIDogW11cbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9XTtcblxuICAgICAgICAgICAgIC8vc2V0IGNhcnRvZ3JhcGhpY0RlZ3JlZXMgaW5mb1xuICAgICAgICAgICAgIGZvcih2YXIgaWR4PTA7IGlkeCA8IHRya1B0cy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICB2YXIgdHJrSW5mbyA9IHRya1B0c1tpZHhdLFxuICAgICAgICAgICAgICAgICAgIGxhdCA9IHBhcnNlRmxvYXQodHJrSW5mby5nZXRBdHRyaWJ1dGUoJ2xhdCcpKSwgIC8vbGF0aXR1ZGVcbiAgICAgICAgICAgICAgICAgICBsb24gPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsb24nKSksICAvL2xvbmdpdHVkZVxuICAgICAgICAgICAgICAgICAgIGVsZSA9IHBhcnNlRmxvYXQoc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2VsZScpWzBdKSksICAvL2VsZVxuICAgICAgICAgICAgICAgICAgIHRpbWUgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGltZScpWzBdKSwgIC8vaW50ZXJ2YWwgdGltZVxuICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbnMgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZXh0ZW5zaW9ucycpWzBdKSwgIC8vZXh0ZW5zaW9uc1xuICAgICAgICAgICAgICAgICAgIHRhcmdldFNlY29uZHMgPSBuZXcgRGF0ZSh0aW1lKS5nZXRUaW1lKCksIC8vaW50ZXJ2YWwgdGltZSBmcm9tIHN0YXJ0U2Vjb25kc1xuICAgICAgICAgICAgICAgICAgIGRlZmZTZWNvbmRzID0gKHRhcmdldFNlY29uZHMgLSBzdGFydFNlY29uZHMpIC8gMTAwMDsgIC8vY29udmVydCBzZWNvbmRcblxuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGRlZmZTZWNvbmRzKTtcbiAgICAgICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsYXQpO1xuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxvbik7XG4gICAgICAgICAgICAgICBjem1sRGF0YVsxXS5wb3NpdGlvbi5jYXJ0b2dyYXBoaWNEZWdyZWVzLnB1c2goZWxlKTtcblxuICAgICAgICAgICAgICAgaWYgKGlkeCA9PSAodHJrUHRzLmxlbmd0aCAtMSkpIHtcbiAgICAgICAgICAgICAgICAgY3ptbERhdGFbMF0uY2xvY2suaW50ZXJ2YWwgPSBzdGFydFRpbWUgKyAnLycgKyB0aW1lO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhmYWxzZSwgY3ptbERhdGEpO1xuICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICB9O1xuXG4gICAgICAgcmV0dXJuIGdweDJjem1sO1xuICAgICB9KTtcbiB9KSk7XG4iXX0=
