!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(e){"use strict";return e.module("ngGpx2czml",[]).service("gpx2czml",["$q","$http",function(e,t){return{async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.parseXml(a)}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseXml:function(e){console.log(e)},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this,r=0;try{for(var a,o,i=(e.getElementsByTagName("metadata")[0],e.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=s.getElementsByTagName("trkpt"),g=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:a,multiplier:1,range:"CLAMPED"}},{position:{epoch:a,cartographicDegrees:[]}}],p=0;p<c.length;p++){var u=c[p],l=parseFloat(u.getAttribute("lat")),f=parseFloat(u.getAttribute("lon")),m=n.getTextTag(u.getElementsByTagName("ele")[0]),h=n.getTextTag(u.getElementsByTagName("time")[0]),y=new Date(h).getTime(),v=0==p?0:(y-o)/1e3;0===p&&(a=h,o=y),r+=m?parseFloat(m):0;var T=r/(p+1);g[1].position.cartographicDegrees.push(v),g[1].position.cartographicDegrees.push(f),g[1].position.cartographicDegrees.push(l),g[1].position.cartographicDegrees.push(m?parseFloat(m):T),p==c.length-1&&(g[0].clock.interval=a+"/"+h,g[1].availability=a+"/"+h)}"function"==typeof t&&t(!1,g)}catch(e){"function"==typeof t&&t(!0,e.toString())}}}}])});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLWdweDJjem1sLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJhbmd1bGFyIiwidGhpcyIsInNlcnZpY2UiLCIkcSIsIiRodHRwIiwiYXN5bmMiLCJ1cmwiLCJjYkZ1bmMiLCJnZXRHcHhEYXRhIiwiaHR0cFJlcXVlc3QiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwic2VsZiIsInBhcnNlR3B4IiwicmVzcG9uc2VUZXh0IiwiaXNFcnJvciIsInJlcyIsIndpbmRvdyIsIlhNTEh0dHBSZXF1ZXN0IiwiQWN0aXZlWE9iamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIm9wZW4iLCJzZW5kIiwiYXN5bmNGcm9tRmlsZSIsImZpbGVzIiwicHJvY2Vzc2luZ0ZpbGVzIiwiY3ptbEVycm9yIiwiY3ptbFJlcyIsImUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwiYnJvd3NlciIsInRhcmdldCIsIm9ubG9hZCIsImRhdGEiLCJyZXN1bHQiLCJjb250ZW50IiwibGVuZ3RoIiwicmVhZEFzVGV4dCIsInRvU3RyaW5nIiwidG1wIiwieG1sIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwibG9hZFhNTCIsImdweE5vZGUiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcnNlWG1sIiwibm9kZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwiYmluZEN6bWxEYXRhIiwic3VtRWxlIiwic3RhcnRUaW1lIiwic3RhcnRTZWNvbmRzIiwidHJrQ29udGVudCIsInRya1NlZyIsInRya1B0cyIsImN6bWxEYXRhIiwibmFtZSIsImdldEF0dHJpYnV0ZSIsInZlcnNpb24iLCJjbG9jayIsImludGVydmFsIiwiY3VycmVudFRpbWUiLCJtdWx0aXBsaWVyIiwicmFuZ2UiLCJwb3NpdGlvbiIsImVwb2NoIiwiY2FydG9ncmFwaGljRGVncmVlcyIsImlkeCIsInRya0luZm8iLCJsYXQiLCJwYXJzZUZsb2F0IiwibG9uIiwiZWxlIiwidGltZSIsInRhcmdldFNlY29uZHMiLCJEYXRlIiwiZ2V0VGltZSIsImRlZmZTZWNvbmRzIiwiYXZnRWxlIiwicHVzaCIsImF2YWlsYWJpbGl0eSJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBVUEsRUFBTUMsR0FDZCxZQUdzQixtQkFBWEMsU0FBeUJBLE9BQU9DLElBQ3pDRCxRQUFRLFdBQVlELEdBQ1EsZ0JBQVpHLFNBQ2hCQyxPQUFPRCxRQUFVSCxFQUFRSyxRQUFRLFlBRWpDTCxFQUFRRCxFQUFLTyxVQUVmQyxLQUFNLFNBQVVELEdBQ2hCLFlBT0EsT0FBT0EsR0FBUUYsT0FBTyxpQkFNbkJJLFFBQVEsWUFBQSxLQUFBLFFBQUEsU0FBQUMsRUFBQUMsR0FtTlAsT0FqTkVDLE1BQVEsU0FBVUMsRUFBS0MsR0FjckIsUUFBU0MsS0FDd0IsSUFBM0JDLEVBQVlDLGFBQ2EsTUFBdkJELEVBQVlFLE9BQ2RDLEVBQUtDLFNBQVNKLEVBQVlLLGFBQWMsU0FBVUMsRUFBU0MsR0FDdEMsa0JBQVZULElBQXdCQSxFQUFPUSxFQUFTQyxLQUdsQyxrQkFBVlQsSUFBd0JBLEdBQU8sRUFBTSx1QkFwQmxELEdBQUlFLEdBQ0FHLEVBQU9YLElBRVBnQixRQUFPQyxlQUNUVCxFQUFjLEdBQUlTLGdCQUNURCxPQUFPRSxnQkFDaEJWLEVBQWMsR0FBSVUsZUFBYyxzQkFHbENWLEVBQVlXLG1CQUFxQlosRUFDakNDLEVBQVlZLEtBQUssTUFBT2YsR0FDeEJHLEVBQVlhLFFBa0JkQyxjQUFnQixTQUFVQyxFQUFPakIsR0FDL0IsR0FBSUssR0FBT1gsSUFFWEEsTUFBS3dCLGdCQUFnQkQsRUFBTyxTQUFVVCxFQUFTQyxHQUV6Q0QsRUFDZSxrQkFBVlIsSUFBd0JBLEVBQU9RLEVBQVNDLEdBRS9DSixFQUFLQyxTQUFTRyxFQUFLLFNBQVVVLEVBQVdDLEdBQ3JCLGtCQUFWcEIsSUFBd0JBLEVBQU9tQixFQUFXQyxR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QUFWckIsSUFBd0JBLEdBQU8sRUFBTXFCLEVBQUVXIiwiZmlsZSI6Im5nLWdweDJjem1sLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAvL0FNRCBtb2RlXG4gICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgIGRlZmluZShbJ2FuZ3VsYXInXSwgZmFjdG9yeSk7XG4gICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnYW5ndWxhcicpKTtcbiAgIH0gZWxzZSB7XG4gICAgIGZhY3Rvcnkocm9vdC5hbmd1bGFyKTtcbiAgIH1cbiB9KHRoaXMsIGZ1bmN0aW9uIChhbmd1bGFyKSB7XG4gICAndXNlIHN0cmljdCc7XG5cbiAgIC8qKlxuICAgICogZ3B4MmN6bWwgQW5ndWxhciAxLjAgbW9kdWxlXG4gICAgKiBAbW9kdWxlIG5nR3B4MmN6bWxcbiAgICAqIEBuYW1lIG5nR3B4MmN6bWxcbiAgICAqL1xuICAgcmV0dXJuIGFuZ3VsYXIubW9kdWxlKCduZ0dweDJjem1sJywgW10pXG4gICAgICAvKipcbiAgICAgICAqIGdweDJjem1sIHNlcnZpY2VcbiAgICAgICAqIEBuYW1lIGdweDJjem1sXG4gICAgICAgKiBAbmdkb2Mgc2VydmljZVxuICAgICAgICovXG4gICAgIC5zZXJ2aWNlKCdncHgyY3ptbCcsIGZ1bmN0aW9uICgkcSwgJGh0dHApIHtcbiAgICAgICB2YXIgZ3B4MmN6bWwgPSB7XG4gICAgICAgICBhc3luYyA6IGZ1bmN0aW9uICh1cmwsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgaHR0cFJlcXVlc3Q7XG4gICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgaHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkge1xuICAgICAgICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MSFRUUFwiKTtcbiAgICAgICAgICAgfVxuXG4gICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGdldEdweERhdGE7XG4gICAgICAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICAgICAgIGh0dHBSZXF1ZXN0LnNlbmQoKTtcblxuICAgICAgICAgICBmdW5jdGlvbiBnZXRHcHhEYXRhKCkge1xuICAgICAgICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgc2VsZi5wYXJzZUdweChodHRwUmVxdWVzdC5yZXNwb25zZVRleHQsIGZ1bmN0aW9uIChpc0Vycm9yLCByZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCAnaHR0cCByZXF1ZXN0IGVycm9yJyk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICB9XG4gICAgICAgICB9LFxuICAgICAgICAgLyoqXG4gICAgICAgICAgKiBncHggZmlsZSB1cGxvYWQg7ZSE66Gc7IS47IuxIOyymOumrChhc3luYylcbiAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgICAgICAqL1xuICAgICAgICAgYXN5bmNGcm9tRmlsZSA6IGZ1bmN0aW9uIChmaWxlcywgY2JGdW5jKSB7XG4gICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcyhmaWxlcywgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuXG4gICAgICAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICBzZWxmLnBhcnNlR3B4KHJlcywgZnVuY3Rpb24gKGN6bWxFcnJvciwgY3ptbFJlcykge1xuICAgICAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoY3ptbEVycm9yLCBjem1sUmVzKTtcbiAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfSk7XG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGdweCBmaWxlIG9iamVjdCDtlITroZzshLjsi7Eg7LKY66asXG4gICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbGVzIGZpbGUgT2JqZWN0XG4gICAgICAgICAgKi9cbiAgICAgICAgIHByb2Nlc3NpbmdGaWxlcyA6IGZ1bmN0aW9uIChlLCBjYkZ1bmMpIHtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgICAgdmFyIGJyb3dzZXIgPSAnY2hyb21lJztcblxuICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuXG4gICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgICAgICBkYXRhID0gcmVhZGVyLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnaWUnO1xuICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBkYXRhKTtcbiAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlc1swXSwgJ1VURi04Jyk7XG4gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgIHRocm93IFwiZmlsZSBpcyBub3QgZGVmaW5lZFwiO1xuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIC8vZmlsZeydhCDsnb3qsowg7ZWc64ukLlxuICAgICAgICAgICAgIC8vcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlc1swXSk7XG4gICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgfVxuXG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIHBhcnNpbmcgZ3B4IGRhdGFcbiAgICAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gZGF0YSBwZ3ggc3RyaW5nIGRhdGFcbiAgICAgICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYkZ1bmMgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gY3ptbERhdGEgY29udmVydCBjem1sIG9iamVjdCBkYXRhXG4gICAgICAgICAgKi9cbiAgICAgICAgIHBhcnNlR3B4IDogZnVuY3Rpb24gKGRhdGEsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgdG1wLHhtbDtcblxuICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgIC8vaWYgRE9NUGFyc2VyIGlzIGV4aXN0XG4gICAgICAgICAgICAgaWYgKHdpbmRvdy5ET01QYXJzZXIpIHtcbiAgICAgICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICAgICAgIHhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEsIFwidGV4dC94bWxcIiApO1xuICAgICAgICAgICAgIH0gZWxzZSB7ICAvL0lFIHZlcnNpb25cbiAgICAgICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcbiAgICAgICAgICAgICAgIHhtbC5hc3luYyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICAgICAgIHhtbC5sb2FkWE1MKGRhdGEpO1xuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIC8vZ2V0IGdweCBub2RlIGZyb20geG1sIGRhdGFcbiAgICAgICAgICAgICB2YXIgZ3B4Tm9kZSA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZ3B4JylbMF07XG5cbiAgICAgICAgICAgICAvL2JpbmQgY3ptbGRhdGFcbiAgICAgICAgICAgIC8vICB0aGlzLmJpbmRDem1sRGF0YShncHhOb2RlLCBmdW5jdGlvbiAoaXNFcnJvciwgY3ptbERhdGEpIHtcbiAgICAgICAgICAgIC8vICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCBjem1sRGF0YSk7XG4gICAgICAgICAgICAvLyAgfSk7XG4gICAgICAgICAgICAgdGhpcy5wYXJzZVhtbChncHhOb2RlKTtcbiAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICB9XG4gICAgICAgICB9LFxuXG4gICAgICAgICBwYXJzZVhtbCA6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgIGNvbnNvbGUubG9nKG5vZGUpO1xuICAgICAgICAgfSxcblxuICAgICAgICAgLyoqXG4gICAgICAgICAgKiBnZXQgdGV4dCBmcm9tIHRhZ1xuICAgICAgICAgICogQHBhcmFtICB7U3RyaW5nfSB0YWcgdGFnIHN0cmluZ1xuICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSB0YWdTdHIgdGFnIHN0cmluZ1xuICAgICAgICAgICovXG4gICAgICAgICBnZXRUZXh0VGFnIDogZnVuY3Rpb24gKHRhZykge1xuICAgICAgICAgICAvL3ZhciB0YWdTdHIgPSB0YWcuaW5uZXJIVE1MLnJlcGxhY2UoLzxbXj5dKj4vZywgXCJcIik7XG4gICAgICAgICAgIHZhciB0YWdTdHIgPSB0YWcudGV4dENvbnRlbnQ7XG4gICAgICAgICAgIHRhZ1N0ci5yZXBsYWNlKC8oXlxccyopfChcXHMqJCkvZ2ksIFwiXCIpO1xuXG4gICAgICAgICAgIHJldHVybiB0YWdTdHI7XG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGN6bWwgZGF0YSBiaW5kaW5nXG4gICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGdweE5vZGUgZ3B4IHhtbCBkb20gbm9kZVxuICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjem1sIG9iamVjdCBkYXRhXG4gICAgICAgICAgKi9cbiAgICAgICAgIGJpbmRDem1sRGF0YSA6IGZ1bmN0aW9uIChncHhOb2RlLCBjYkZ1bmMpIHtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICB2YXIgc3VtRWxlID0gMDtcblxuICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgIC8veG1sIHBhcnNpbmdcbiAgICAgICAgICAgICB2YXIgbWV0YURhdGEgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdtZXRhZGF0YScpWzBdLCAvL21ldGFkYXRhXG4gICAgICAgICAgICAgICAgIHRya0NvbnRlbnQgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmsnKVswXSwgIC8vdHJhY2tpbmcgZGF0YVxuICAgICAgICAgICAgICAgICB0cmtTZWcgPSB0cmtDb250ZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtzZWcnKVswXSwgIC8vdHJrc2VnXG4gICAgICAgICAgICAgICAgIHRya1B0cyA9IHRya1NlZy5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHJrcHQnKTsgIC8vdHJhY2tpbmcgcG9pbnQgYXJyYXlzXG5cbiAgICAgICAgICAgICAvL2dldCBzdGFydCB0aW1lXG4gICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgc3RhcnRTZWNvbmRzO1xuXG4gICAgICAgICAgICAgLy9iaW5kaW5nIHRhcmdldFxuICAgICAgICAgICAgIHZhciBjem1sRGF0YSA9IFt7XG4gICAgICAgICAgICAgICBuYW1lIDogZ3B4Tm9kZS5nZXRBdHRyaWJ1dGUoJ2NyZWF0b3InKSxcbiAgICAgICAgICAgICAgIHZlcnNpb24gOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgndmVyc2lvbicpLFxuICAgICAgICAgICAgICAgY2xvY2sgOiB7XG4gICAgICAgICAgICAgICAgIGludGVydmFsIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgY3VycmVudFRpbWUgOiBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgIG11bHRpcGxpZXIgOiAxLFxuICAgICAgICAgICAgICAgICByYW5nZSA6ICdDTEFNUEVEJ1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgIHBvc2l0aW9uIDoge1xuICAgICAgICAgICAgICAgICBlcG9jaCA6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgICAgICAgY2FydG9ncmFwaGljRGVncmVlcyA6IFtdXG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfV07XG5cbiAgICAgICAgICAgICAvL3NldCBjYXJ0b2dyYXBoaWNEZWdyZWVzIGluZm9cbiAgICAgICAgICAgICBmb3IodmFyIGlkeD0wOyBpZHggPCB0cmtQdHMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgdmFyIHRya0luZm8gPSB0cmtQdHNbaWR4XSxcbiAgICAgICAgICAgICAgICAgICBsYXQgPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsYXQnKSksICAvL2xhdGl0dWRlXG4gICAgICAgICAgICAgICAgICAgbG9uID0gcGFyc2VGbG9hdCh0cmtJbmZvLmdldEF0dHJpYnV0ZSgnbG9uJykpLCAgLy9sb25naXR1ZGVcbiAgICAgICAgICAgICAgICAgICBlbGUgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZWxlJylbMF0pLCAgLy9lbGVcbiAgICAgICAgICAgICAgICAgICB0aW1lID0gc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpbWUnKVswXSksICAvL2ludGVydmFsIHRpbWVcbiAgICAgICAgICAgICAgICAgICB0YXJnZXRTZWNvbmRzID0gbmV3IERhdGUodGltZSkuZ2V0VGltZSgpLCAvL2ludGVydmFsIHRpbWUgZnJvbSBzdGFydFNlY29uZHNcbiAgICAgICAgICAgICAgICAgICBkZWZmU2Vjb25kcyA9IChpZHggPT0gMD8gMCA6ICgodGFyZ2V0U2Vjb25kcyAtIHN0YXJ0U2Vjb25kcykgLyAxMDAwKSk7ICAvL2NvbnZlcnQgc2Vjb25kXG5cbiAgICAgICAgICAgICAgIGlmIChpZHggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgc3RhcnRUaW1lID0gdGltZTtcbiAgICAgICAgICAgICAgICAgc3RhcnRTZWNvbmRzID0gdGFyZ2V0U2Vjb25kcztcbiAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgLy9lbGUgaW50ZXJwb2xhdGVcbiAgICAgICAgICAgICAgIHN1bUVsZSArPSAoZWxlP3BhcnNlRmxvYXQoZWxlKSA6IDApO1xuXG4gICAgICAgICAgICAgICB2YXIgYXZnRWxlID0gc3VtRWxlIC8gKGlkeCsxKTtcblxuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGRlZmZTZWNvbmRzKTtcbiAgICAgICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsb24pO1xuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxhdCk7XG4gICAgICAgICAgICAgICBjem1sRGF0YVsxXS5wb3NpdGlvbi5jYXJ0b2dyYXBoaWNEZWdyZWVzLnB1c2goZWxlPyBwYXJzZUZsb2F0KGVsZSkgOiBhdmdFbGUpO1xuXG4gICAgICAgICAgICAgICBpZiAoaWR4ID09ICh0cmtQdHMubGVuZ3RoIC0xKSkge1xuICAgICAgICAgICAgICAgICBjem1sRGF0YVswXS5jbG9jay5pbnRlcnZhbCA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgICAgICAgIGN6bWxEYXRhWzFdLmF2YWlsYWJpbGl0eSA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBjem1sRGF0YSk7XG4gICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgIH07XG5cbiAgICAgICByZXR1cm4gZ3B4MmN6bWw7XG4gICAgIH0pO1xuIH0pKTtcbiJdfQ==
