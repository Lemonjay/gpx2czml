!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof exports?module.exports=e(require("angular")):e(t.angular)}(this,function(t){"use strict";return t.module("ngGpx2czml",[]).service("gpx2czml",["$q","$http",function(t,e){return{async:function(t,e){function n(){4===a.readyState&&(200===a.status?i.parseGpx(a.responseText,function(t,n){"function"==typeof e&&e(t,n)}):"function"==typeof e&&e(!0,"http request error"))}var a,i=this;window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=n,a.open("GET",t),a.send()},asyncFromFile:function(t,e){var n=this;this.processingFiles(t,function(t,a){t?"function"==typeof e&&e(t,a):n.parseGpx(a,function(t,n){"function"==typeof e&&e(t,n)})})},processingFiles:function(t,e){var n=new FileReader,a="chrome";try{var i=t.target.files;if(n.onload=function(t){var i;t?i=t.target.result:(i=n.content,a="ie"),"function"==typeof e&&e(!1,i)},!(i.length>0))throw"file is not defined";n.readAsText(i[0],"UTF-8")}catch(t){"function"==typeof e&&e(!0,t.toString())}},parseGpx:function(t,e){var n,a;try{window.DOMParser?(n=new DOMParser,a=n.parseFromString(t,"text/xml")):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(t));var i=a.getElementsByTagName("gpx")[0];this.bindCzmlData(i,function(t,n){"function"==typeof e&&e(t,n)})}catch(t){"function"==typeof e&&e(!0,t.toString())}},getTextTag:function(t){var e=t.textContent;return e.replace(/(^\s*)|(\s*$)/gi,""),e},bindCzmlData:function(t,e){var n=this;try{for(var a=t.getElementsByTagName("metadata")[0],i=a.getElementsByTagName("time")[0],o=t.getElementsByTagName("trk")[0],r=o.getElementsByTagName("trkseg")[0],s=r.getElementsByTagName("trkpt"),c=this.getTextTag(i),g=new Date(c).getTime(),f=[{version:t.getAttribute("version")},{position:{cartographicDegrees:[]}}],u=0;u<s.length;u++){var p=s[u],l=parseFloat(p.getAttribute("lat")),m=parseFloat(p.getAttribute("lon")),y=parseFloat(n.getTextTag(p.getElementsByTagName("ele")[0])),T=n.getTextTag(p.getElementsByTagName("time")[0]),d=(n.getTextTag(p.getElementsByTagName("extensions")[0]),new Date(T).getTime()),h=(d-g)/1e3,x=[h,l,m,y];f[1].position.cartographicDegrees[u]=x}"function"==typeof e&&e(!1,f)}catch(t){"function"==typeof e&&e(!0,t.toString())}}}}])});