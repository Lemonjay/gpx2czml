!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(e){"use strict";return e.module("ngGpx2czml",[]).service("gpx2czml",["$q","$http",function(e,t){return{async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.parseXml(a)}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseXml:function(e){console.log(e)},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this,r=0;try{for(var a,o,i=(e.getElementsByTagName("metadata")[0],e.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=i.getElementsByTagName("ele"),g=s.getElementsByTagName("trkpt"),l=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:a,multiplier:1,range:"CLAMPED"}},{position:{epoch:a,cartographicDegrees:[]}}],p=0;p<c.length;p++){r+=parseFloat(n.getTextTag(c[p]))}for(var u=r/c.length,p=0;p<g.length;p++){var f=g[p],m=parseFloat(f.getAttribute("lat")),h=parseFloat(f.getAttribute("lon")),y=n.getTextTag(f.getElementsByTagName("ele")[0]),T=n.getTextTag(f.getElementsByTagName("time")[0]),v=new Date(T).getTime(),d=0==p?0:(v-o)/1e3;0===p&&(a=T,o=v);var u=r/(p+1);l[1].position.cartographicDegrees.push(d),l[1].position.cartographicDegrees.push(h),l[1].position.cartographicDegrees.push(m),l[1].position.cartographicDegrees.push(y?parseFloat(y):Math.round(u)),p==g.length-1&&(l[0].clock.interval=a+"/"+T,l[1].availability=a+"/"+T)}"function"==typeof t&&t(!1,l)}catch(e){"function"==typeof t&&t(!0,e.toString())}}}}])});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLWdweDJjem1sLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJhbmd1bGFyIiwidGhpcyIsInNlcnZpY2UiLCIkcSIsIiRodHRwIiwiYXN5bmMiLCJ1cmwiLCJjYkZ1bmMiLCJnZXRHcHhEYXRhIiwiaHR0cFJlcXVlc3QiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwic2VsZiIsInBhcnNlR3B4IiwicmVzcG9uc2VUZXh0IiwiaXNFcnJvciIsInJlcyIsIndpbmRvdyIsIlhNTEh0dHBSZXF1ZXN0IiwiQWN0aXZlWE9iamVjdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIm9wZW4iLCJzZW5kIiwiYXN5bmNGcm9tRmlsZSIsImZpbGVzIiwicHJvY2Vzc2luZ0ZpbGVzIiwiY3ptbEVycm9yIiwiY3ptbFJlcyIsImUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwiYnJvd3NlciIsInRhcmdldCIsIm9ubG9hZCIsImRhdGEiLCJyZXN1bHQiLCJjb250ZW50IiwibGVuZ3RoIiwicmVhZEFzVGV4dCIsInRvU3RyaW5nIiwidG1wIiwieG1sIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwibG9hZFhNTCIsImdweE5vZGUiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcnNlWG1sIiwibm9kZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwiYmluZEN6bWxEYXRhIiwic3VtRWxlIiwic3RhcnRUaW1lIiwic3RhcnRTZWNvbmRzIiwidHJrQ29udGVudCIsInRya1NlZyIsImVsZXMiLCJ0cmtQdHMiLCJjem1sRGF0YSIsIm5hbWUiLCJnZXRBdHRyaWJ1dGUiLCJ2ZXJzaW9uIiwiY2xvY2siLCJpbnRlcnZhbCIsImN1cnJlbnRUaW1lIiwibXVsdGlwbGllciIsInJhbmdlIiwicG9zaXRpb24iLCJlcG9jaCIsImNhcnRvZ3JhcGhpY0RlZ3JlZXMiLCJpZHgiLCJwYXJzZUZsb2F0IiwiYXZnRWxlIiwidHJrSW5mbyIsImxhdCIsImxvbiIsImVsZSIsInRpbWUiLCJ0YXJnZXRTZWNvbmRzIiwiRGF0ZSIsImdldFRpbWUiLCJkZWZmU2Vjb25kcyIsInB1c2giLCJNYXRoIiwicm91bmQiLCJhdmFpbGFiaWxpdHkiXSwibWFwcGluZ3MiOiJDQUFDLFNBQVVBLEVBQU1DLEdBQ2QsWUFHc0IsbUJBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsUUFBUSxXQUFZRCxHQUNRLGdCQUFaRyxTQUNoQkMsT0FBT0QsUUFBVUgsRUFBUUssUUFBUSxZQUVqQ0wsRUFBUUQsRUFBS08sVUFFZkMsS0FBTSxTQUFVRCxHQUNoQixZQU9BLE9BQU9BLEdBQVFGLE9BQU8saUJBTW5CSSxRQUFRLFlBQUEsS0FBQSxRQUFBLFNBQUFDLEVBQUFDLEdBeU5QLE9Bdk5FQyxNQUFRLFNBQVVDLEVBQUtDLEdBY3JCLFFBQVNDLEtBQ3dCLElBQTNCQyxFQUFZQyxhQUNhLE1BQXZCRCxFQUFZRSxPQUNkQyxFQUFLQyxTQUFTSixFQUFZSyxhQUFjLFNBQVVDLEVBQVNDLEdBQ3RDLGtCQUFWVCxJQUF3QkEsRUFBT1EsRUFBU0MsS0FHbEMsa0JBQVZULElBQXdCQSxHQUFPLEVBQU0sdUJBcEJsRCxHQUFJRSxHQUNBRyxFQUFPWCxJQUVQZ0IsUUFBT0MsZUFDVFQsRUFBYyxHQUFJUyxnQkFDVEQsT0FBT0UsZ0JBQ2hCVixFQUFjLEdBQUlVLGVBQWMsc0JBR2xDVixFQUFZVyxtQkFBcUJaLEVBQ2pDQyxFQUFZWSxLQUFLLE1BQU9mLEdBQ3hCRyxFQUFZYSxRQWtCZEMsY0FBZ0IsU0FBVUMsRUFBT2pCLEdBQy9CLEdBQUlLLEdBQU9YLElBRVhBLE1BQUt3QixnQkFBZ0JELEVBQU8sU0FBVVQsRUFBU0MsR0FFekNELEVBQ2Usa0JBQVZSLElBQXdCQSxFQUFPUSxFQUFTQyxHQUUvQ0osRUFBS0MsU0FBU0csRUFBSyxTQUFVVSxFQUFXQyxHQUNyQixrQkFBVnBC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QUFRYixFQUFPMUIsT0FBUSxJQUN6QjJCLEVBQVMsR0FBR0ksTUFBTUMsU0FBV1gsRUFBWSxJQUFNeUIsRUFDL0NuQixFQUFTLEdBQUcyQixhQUFlakMsRUFBWSxJQUFNeUIsR0FJaEMsa0JBQVY1RSxJQUF3QkEsR0FBTyxFQUFPeUQsR0FDN0MsTUFBT3BDLEdBQ1Usa0JBQVZyQixJQUF3QkEsR0FBTyxFQUFNcUIsRUFBRVciLCJmaWxlIjoibmctZ3B4MmN6bWwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAndXNlIHN0cmljdCc7XG5cbiAgIC8vQU1EIG1vZGVcbiAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgZGVmaW5lKFsnYW5ndWxhciddLCBmYWN0b3J5KTtcbiAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdhbmd1bGFyJykpO1xuICAgfSBlbHNlIHtcbiAgICAgZmFjdG9yeShyb290LmFuZ3VsYXIpO1xuICAgfVxuIH0odGhpcywgZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICd1c2Ugc3RyaWN0JztcblxuICAgLyoqXG4gICAgKiBncHgyY3ptbCBBbmd1bGFyIDEuMCBtb2R1bGVcbiAgICAqIEBtb2R1bGUgbmdHcHgyY3ptbFxuICAgICogQG5hbWUgbmdHcHgyY3ptbFxuICAgICovXG4gICByZXR1cm4gYW5ndWxhci5tb2R1bGUoJ25nR3B4MmN6bWwnLCBbXSlcbiAgICAgIC8qKlxuICAgICAgICogZ3B4MmN6bWwgc2VydmljZVxuICAgICAgICogQG5hbWUgZ3B4MmN6bWxcbiAgICAgICAqIEBuZ2RvYyBzZXJ2aWNlXG4gICAgICAgKi9cbiAgICAgLnNlcnZpY2UoJ2dweDJjem1sJywgZnVuY3Rpb24gKCRxLCAkaHR0cCkge1xuICAgICAgIHZhciBncHgyY3ptbCA9IHtcbiAgICAgICAgIGFzeW5jIDogZnVuY3Rpb24gKHVybCwgY2JGdW5jKSB7XG4gICAgICAgICAgIHZhciBodHRwUmVxdWVzdDtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICBodHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7XG4gICAgICAgICAgICAgaHR0cFJlcXVlc3QgPSBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxIVFRQXCIpO1xuICAgICAgICAgICB9XG5cbiAgICAgICAgICAgaHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZ2V0R3B4RGF0YTtcbiAgICAgICAgICAgaHR0cFJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgICAgICAgaHR0cFJlcXVlc3Quc2VuZCgpO1xuXG4gICAgICAgICAgIGZ1bmN0aW9uIGdldEdweERhdGEoKSB7XG4gICAgICAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgIGlmIChodHRwUmVxdWVzdC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICBzZWxmLnBhcnNlR3B4KGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dCwgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIHJlcyk7XG4gICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsICdodHRwIHJlcXVlc3QgZXJyb3InKTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9XG4gICAgICAgICAgIH1cbiAgICAgICAgIH0sXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGdweCBmaWxlIHVwbG9hZCDtlITroZzshLjsi7Eg7LKY66asKGFzeW5jKVxuICAgICAgICAgICogQHBhcmFtICB7T2JqZWN0fSBmaWxlcyBmaWxlIE9iamVjdFxuICAgICAgICAgICovXG4gICAgICAgICBhc3luY0Zyb21GaWxlIDogZnVuY3Rpb24gKGZpbGVzLCBjYkZ1bmMpIHtcbiAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzKGZpbGVzLCBmdW5jdGlvbiAoaXNFcnJvciwgcmVzKSB7XG5cbiAgICAgICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIHJlcyk7XG4gICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgIHNlbGYucGFyc2VHcHgocmVzLCBmdW5jdGlvbiAoY3ptbEVycm9yLCBjem1sUmVzKSB7XG4gICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhjem1sRXJyb3IsIGN6bWxSZXMpO1xuICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICB9KTtcbiAgICAgICAgIH0sXG5cbiAgICAgICAgIC8qKlxuICAgICAgICAgICogZ3B4IGZpbGUgb2JqZWN0IO2UhOuhnOyEuOyLsSDsspjrpqxcbiAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgICAgICAqL1xuICAgICAgICAgcHJvY2Vzc2luZ0ZpbGVzIDogZnVuY3Rpb24gKGUsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICAgICB2YXIgYnJvd3NlciA9ICdjaHJvbWUnO1xuXG4gICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXM7XG5cbiAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgIHZhciBkYXRhO1xuICAgICAgICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICAgICAgIGRhdGEgPSByZWFkZXIuY29udGVudDtcbiAgICAgICAgICAgICAgICAgYnJvd3NlciA9ICdpZSc7XG4gICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICBkYXRhID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoZmFsc2UsIGRhdGEpO1xuICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGVzWzBdLCAnVVRGLTgnKTtcbiAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgdGhyb3cgXCJmaWxlIGlzIG5vdCBkZWZpbmVkXCI7XG4gICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgLy9maWxl7J2EIOydveqyjCDtlZzri6QuXG4gICAgICAgICAgICAgLy9yZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGVzWzBdKTtcbiAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICB9XG5cbiAgICAgICAgIH0sXG5cbiAgICAgICAgIC8qKlxuICAgICAgICAgICogcGFyc2luZyBncHggZGF0YVxuICAgICAgICAgICogQHBhcmFtICB7U3RyaW5nfSBkYXRhIHBneCBzdHJpbmcgZGF0YVxuICAgICAgICAgICogQHBhcmFtICB7RnVuY3Rpb259IGNiRnVuYyBjYWxsYmFjayBmdW5jdGlvblxuICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjb252ZXJ0IGN6bWwgb2JqZWN0IGRhdGFcbiAgICAgICAgICAqL1xuICAgICAgICAgcGFyc2VHcHggOiBmdW5jdGlvbiAoZGF0YSwgY2JGdW5jKSB7XG4gICAgICAgICAgIHZhciB0bXAseG1sO1xuXG4gICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgLy9pZiBET01QYXJzZXIgaXMgZXhpc3RcbiAgICAgICAgICAgICBpZiAod2luZG93LkRPTVBhcnNlcikge1xuICAgICAgICAgICAgICAgdG1wID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgICAgICAgICAgeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSwgXCJ0ZXh0L3htbFwiICk7XG4gICAgICAgICAgICAgfSBlbHNlIHsgIC8vSUUgdmVyc2lvblxuICAgICAgICAgICAgICAgeG1sID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpO1xuICAgICAgICAgICAgICAgeG1sLmFzeW5jID0gXCJmYWxzZVwiO1xuICAgICAgICAgICAgICAgeG1sLmxvYWRYTUwoZGF0YSk7XG4gICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgLy9nZXQgZ3B4IG5vZGUgZnJvbSB4bWwgZGF0YVxuICAgICAgICAgICAgIHZhciBncHhOb2RlID0geG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdncHgnKVswXTtcblxuICAgICAgICAgICAgIC8vYmluZCBjem1sZGF0YVxuICAgICAgICAgICAgLy8gIHRoaXMuYmluZEN6bWxEYXRhKGdweE5vZGUsIGZ1bmN0aW9uIChpc0Vycm9yLCBjem1sRGF0YSkge1xuICAgICAgICAgICAgLy8gICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIGN6bWxEYXRhKTtcbiAgICAgICAgICAgIC8vICB9KTtcbiAgICAgICAgICAgICB0aGlzLnBhcnNlWG1sKGdweE5vZGUpO1xuICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgIH1cbiAgICAgICAgIH0sXG5cbiAgICAgICAgIHBhcnNlWG1sIDogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgY29uc29sZS5sb2cobm9kZSk7XG4gICAgICAgICB9LFxuXG4gICAgICAgICAvKipcbiAgICAgICAgICAqIGdldCB0ZXh0IGZyb20gdGFnXG4gICAgICAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IHRhZyB0YWcgc3RyaW5nXG4gICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRhZ1N0ciB0YWcgc3RyaW5nXG4gICAgICAgICAgKi9cbiAgICAgICAgIGdldFRleHRUYWcgOiBmdW5jdGlvbiAodGFnKSB7XG4gICAgICAgICAgIC8vdmFyIHRhZ1N0ciA9IHRhZy5pbm5lckhUTUwucmVwbGFjZSgvPFtePl0qPi9nLCBcIlwiKTtcbiAgICAgICAgICAgdmFyIHRhZ1N0ciA9IHRhZy50ZXh0Q29udGVudDtcbiAgICAgICAgICAgdGFnU3RyLnJlcGxhY2UoLyheXFxzKil8KFxccyokKS9naSwgXCJcIik7XG5cbiAgICAgICAgICAgcmV0dXJuIHRhZ1N0cjtcbiAgICAgICAgIH0sXG5cbiAgICAgICAgIC8qKlxuICAgICAgICAgICogY3ptbCBkYXRhIGJpbmRpbmdcbiAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gZ3B4Tm9kZSBncHggeG1sIGRvbSBub2RlXG4gICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGN6bWxEYXRhIGN6bWwgb2JqZWN0IGRhdGFcbiAgICAgICAgICAqL1xuICAgICAgICAgYmluZEN6bWxEYXRhIDogZnVuY3Rpb24gKGdweE5vZGUsIGNiRnVuYykge1xuICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgIHZhciBzdW1FbGUgPSAwO1xuXG4gICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgLy94bWwgcGFyc2luZ1xuICAgICAgICAgICAgIHZhciBtZXRhRGF0YSA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGFkYXRhJylbMF0sIC8vbWV0YWRhdGFcbiAgICAgICAgICAgICAgICAgdHJrQ29udGVudCA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyaycpWzBdLCAgLy90cmFja2luZyBkYXRhXG4gICAgICAgICAgICAgICAgIHRya1NlZyA9IHRya0NvbnRlbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rya3NlZycpWzBdLCAgLy90cmtzZWdcbiAgICAgICAgICAgICAgICAgZWxlcyA9IHRya0NvbnRlbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2VsZScpLFxuICAgICAgICAgICAgICAgICB0cmtQdHMgPSB0cmtTZWcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rya3B0Jyk7ICAvL3RyYWNraW5nIHBvaW50IGFycmF5c1xuXG4gICAgICAgICAgICAgLy9nZXQgc3RhcnQgdGltZVxuICAgICAgICAgICAgIHZhciBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgIHN0YXJ0U2Vjb25kcztcblxuICAgICAgICAgICAgIC8vYmluZGluZyB0YXJnZXRcbiAgICAgICAgICAgICB2YXIgY3ptbERhdGEgPSBbe1xuICAgICAgICAgICAgICAgbmFtZSA6IGdweE5vZGUuZ2V0QXR0cmlidXRlKCdjcmVhdG9yJyksXG4gICAgICAgICAgICAgICB2ZXJzaW9uIDogZ3B4Tm9kZS5nZXRBdHRyaWJ1dGUoJ3ZlcnNpb24nKSxcbiAgICAgICAgICAgICAgIGNsb2NrIDoge1xuICAgICAgICAgICAgICAgICBpbnRlcnZhbCA6IG51bGwsXG4gICAgICAgICAgICAgICAgIGN1cnJlbnRUaW1lIDogc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgICBtdWx0aXBsaWVyIDogMSxcbiAgICAgICAgICAgICAgICAgcmFuZ2UgOiAnQ0xBTVBFRCdcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICBwb3NpdGlvbiA6IHtcbiAgICAgICAgICAgICAgICAgZXBvY2ggOiBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgIGNhcnRvZ3JhcGhpY0RlZ3JlZXMgOiBbXVxuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH1dO1xuXG4gICAgICAgICAgICAgZm9yKHZhciBpZHg9MDsgaWR4IDwgZWxlcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICB2YXIgZWxlSW5mbyA9IHBhcnNlRmxvYXQoc2VsZi5nZXRUZXh0VGFnKGVsZXNbaWR4XSkpO1xuXG4gICAgICAgICAgICAgICBzdW1FbGUgKz0gZWxlSW5mbztcbiAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICB2YXIgYXZnRWxlID0gc3VtRWxlIC8gKGVsZXMubGVuZ3RoKTtcblxuICAgICAgICAgICAgIC8vc2V0IGNhcnRvZ3JhcGhpY0RlZ3JlZXMgaW5mb1xuICAgICAgICAgICAgIGZvcih2YXIgaWR4PTA7IGlkeCA8IHRya1B0cy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICB2YXIgdHJrSW5mbyA9IHRya1B0c1tpZHhdLFxuICAgICAgICAgICAgICAgICAgIGxhdCA9IHBhcnNlRmxvYXQodHJrSW5mby5nZXRBdHRyaWJ1dGUoJ2xhdCcpKSwgIC8vbGF0aXR1ZGVcbiAgICAgICAgICAgICAgICAgICBsb24gPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsb24nKSksICAvL2xvbmdpdHVkZVxuICAgICAgICAgICAgICAgICAgIGVsZSA9IHNlbGYuZ2V0VGV4dFRhZyh0cmtJbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdlbGUnKVswXSksICAvL2VsZVxuICAgICAgICAgICAgICAgICAgIHRpbWUgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGltZScpWzBdKSwgIC8vaW50ZXJ2YWwgdGltZVxuICAgICAgICAgICAgICAgICAgIHRhcmdldFNlY29uZHMgPSBuZXcgRGF0ZSh0aW1lKS5nZXRUaW1lKCksIC8vaW50ZXJ2YWwgdGltZSBmcm9tIHN0YXJ0U2Vjb25kc1xuICAgICAgICAgICAgICAgICAgIGRlZmZTZWNvbmRzID0gKGlkeCA9PSAwPyAwIDogKCh0YXJnZXRTZWNvbmRzIC0gc3RhcnRTZWNvbmRzKSAvIDEwMDApKTsgIC8vY29udmVydCBzZWNvbmRcblxuICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICBzdGFydFRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgICAgICBzdGFydFNlY29uZHMgPSB0YXJnZXRTZWNvbmRzO1xuICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICB2YXIgYXZnRWxlID0gc3VtRWxlIC8gKGlkeCsxKTtcblxuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGRlZmZTZWNvbmRzKTtcbiAgICAgICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsb24pO1xuICAgICAgICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxhdCk7XG4gICAgICAgICAgICAgICBjem1sRGF0YVsxXS5wb3NpdGlvbi5jYXJ0b2dyYXBoaWNEZWdyZWVzLnB1c2goZWxlPyBwYXJzZUZsb2F0KGVsZSkgOiBNYXRoLnJvdW5kKGF2Z0VsZSkpO1xuXG4gICAgICAgICAgICAgICBpZiAoaWR4ID09ICh0cmtQdHMubGVuZ3RoIC0xKSkge1xuICAgICAgICAgICAgICAgICBjem1sRGF0YVswXS5jbG9jay5pbnRlcnZhbCA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgICAgICAgIGN6bWxEYXRhWzFdLmF2YWlsYWJpbGl0eSA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBjem1sRGF0YSk7XG4gICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgIH07XG5cbiAgICAgICByZXR1cm4gZ3B4MmN6bWw7XG4gICAgIH0pO1xuIH0pKTtcbiJdfQ==
