"use strict";!function(){FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t="",n=this,r=new FileReader;r.onload=function(e){for(var a=new Uint8Array(r.result),o=a.byteLength,i=0;i<o;i++)t+=String.fromCharCode(a[i]);n.content=t,$(n).trigger("onload")},r.readAsArrayBuffer(e)});var e={async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(e,n){"function"==typeof t&&t(e,n)})}catch(e){"function"==typeof t&&t(!0,e.toString())}},getTextTag:function(e){try{var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t}catch(e){return null}},bindCzmlData:function(e,t){var n=this,r=0;try{for(var a,o,i=(e.getElementsByTagName("metadata")[0],e.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=i.getElementsByTagName("ele"),g=s.getElementsByTagName("trkpt"),l=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:a,multiplier:1,range:"CLAMPED"}},{position:{epoch:a,cartographicDegrees:[]}}],p=0;p<c.length;p++){r+=parseFloat(n.getTextTag(c[p]))}for(var f=r/c.length,p=0;p<g.length;p++){var u=g[p],y=parseFloat(u.getAttribute("lat")),h=parseFloat(u.getAttribute("lon")),m=n.getTextTag(u.getElementsByTagName("ele")[0]),d=n.getTextTag(u.getElementsByTagName("time")[0]),T=new Date(d).getTime(),v=0==p?0:(T-o)/1e3;0===p&&(a=d,o=T),l[1].position.cartographicDegrees.push(v),l[1].position.cartographicDegrees.push(h),l[1].position.cartographicDegrees.push(y),l[1].position.cartographicDegrees.push(m?parseFloat(m):Math.round(f)),p==g.length-1&&(l[0].clock.interval=a+"/"+d,l[1].availability=a+"/"+d)}"function"==typeof t&&t(!1,l)}catch(e){"function"==typeof t&&t(!0,e.toString())}}};"undefined"!=typeof exports?module.exports=e:window.gpx2czml=e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdweDJjem1sLmpzIl0sIm5hbWVzIjpbIkZpbGVSZWFkZXIiLCJwcm90b3R5cGUiLCJyZWFkQXNCaW5hcnlTdHJpbmciLCJmaWxlRGF0YSIsImJpbmFyeSIsInB0IiwidGhpcyIsInJlYWRlciIsIm9ubG9hZCIsImUiLCJieXRlcyIsIlVpbnQ4QXJyYXkiLCJyZXN1bHQiLCJsZW5ndGgiLCJieXRlTGVuZ3RoIiwiaSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImNvbnRlbnQiLCIkIiwidHJpZ2dlciIsInJlYWRBc0FycmF5QnVmZmVyIiwiZ3B4MmN6bWwiLCJhc3luYyIsInVybCIsImNiRnVuYyIsImdldEdweERhdGEiLCJodHRwUmVxdWVzdCIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJzZWxmIiwicGFyc2VHcHgiLCJyZXNwb25zZVRleHQiLCJpc0Vycm9yIiwicmVzIiwid2luZG93IiwiWE1MSHR0cFJlcXVlc3QiLCJBY3RpdmVYT2JqZWN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwib3BlbiIsInNlbmQiLCJhc3luY0Zyb21GaWxlIiwiZmlsZXMiLCJwcm9jZXNzaW5nRmlsZXMiLCJjem1sRXJyb3IiLCJjem1sUmVzIiwiYnJvd3NlciIsInRhcmdldCIsImRhdGEiLCJyZWFkQXNUZXh0IiwidG9TdHJpbmciLCJ0bXAiLCJ4bWwiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJsb2FkWE1MIiwiZ3B4Tm9kZSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiYmluZEN6bWxEYXRhIiwiY3ptbERhdGEiLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwic3VtRWxlIiwic3RhcnRUaW1lIiwic3RhcnRTZWNvbmRzIiwidHJrQ29udGVudCIsInRya1NlZyIsImVsZXMiLCJ0cmtQdHMiLCJuYW1lIiwiZ2V0QXR0cmlidXRlIiwidmVyc2lvbiIsImNsb2NrIiwiaW50ZXJ2YWwiLCJjdXJyZW50VGltZSIsIm11bHRpcGxpZXIiLCJyYW5nZSIsInBvc2l0aW9uIiwiZXBvY2giLCJjYXJ0b2dyYXBoaWNEZWdyZWVzIiwiaWR4IiwicGFyc2VGbG9hdCIsImF2Z0VsZSIsInRya0luZm8iLCJsYXQiLCJsb24iLCJlbGUiLCJ0aW1lIiwidGFyZ2V0U2Vjb25kcyIsIkRhdGUiLCJnZXRUaW1lIiwiZGVmZlNlY29uZHMiLCJwdXNoIiwiTWF0aCIsInJvdW5kIiwiYXZhaWxhYmlsaXR5IiwiZXhwb3J0cyIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUNPQSxXQUFXQyxVQUFVQyxxQkFDeEJGLFdBQVdDLFVBQVVDLG1CQUFxQixTQUFVQyxHQUNsRCxHQUFJQyxHQUFTLEdBQ1RDLEVBQUtDLEtBQ0xDLEVBQVMsR0FBSVAsV0FDakJPLEdBQU9DLE9BQVMsU0FBVUMsR0FHeEIsSUFBSyxHQUZEQyxHQUFRLEdBQUlDLFlBQVdKLEVBQU9LLFFBQzlCQyxFQUFTSCxFQUFNSSxXQUNWQyxFQUFJLEVBQUdBLEVBQUlGLEVBQVFFLElBQzFCWCxHQUFVWSxPQUFPQyxhQUFhUCxFQUFNSyxHQUd0Q1YsR0FBR2EsUUFBVWQsRUFDYmUsRUFBRWQsR0FBSWUsUUFBUSxXQUVoQmIsRUFBT2Msa0JBQWtCbEIsSUFJN0IsSUFBSW1CLElBQ0ZDLE1BQVEsU0FBVUMsRUFBS0MsR0FjckIsUUFBU0MsS0FDd0IsSUFBM0JDLEVBQVlDLGFBQ2EsTUFBdkJELEVBQVlFLE9BQ2RDLEVBQUtDLFNBQVNKLEVBQVlLLGFBQWMsU0FBVUMsRUFBU0MsR0FDdEMsa0JBQVZULElBQXdCQSxFQUFPUSxFQUFTQyxLQUdsQyxrQkFBVlQsSUFBd0JBLEdBQU8sRUFBTSx1QkFwQmxELEdBQUlFLEdBQ0FHLEVBQU94QixJQUVQNkIsUUFBT0MsZUFDVFQsRUFBYyxHQUFJUyxnQkFDVEQsT0FBT0UsZ0JBQ2hCVixFQUFjLEdBQUlVLGVBQWMsc0JBR2xDVixFQUFZVyxtQkFBcUJaLEVBQ2pDQyxFQUFZWSxLQUFLLE1BQU9mLEdBQ3hCRyxFQUFZYSxRQWtCZEMs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R2pCaEMsRUFBUyxHQUFHcUIsU0FBU0Usb0JBQW9CYSxLQUFLRCxHQUM5Q25DLEVBQVMsR0FBR3FCLFNBQVNFLG9CQUFvQmEsS0FBS1AsR0FDOUM3QixFQUFTLEdBQUdxQixTQUFTRSxvQkFBb0JhLEtBQUtSLEdBQzlDNUIsRUFBUyxHQUFHcUIsU0FBU0Usb0JBQW9CYSxLQUFLTixFQUFLTCxXQUFXSyxHQUFPTyxLQUFLQyxNQUFNWixJQUU1RUYsR0FBUVosRUFBTzFELE9BQVEsSUFDekI4QyxFQUFTLEdBQUdnQixNQUFNQyxTQUFXVixFQUFZLElBQU13QixFQUMvQy9CLEVBQVMsR0FBR3VDLGFBQWVoQyxFQUFZLElBQU13QixHQUloQyxrQkFBVmpFLElBQXdCQSxHQUFPLEVBQU9rQyxHQUM3QyxNQUFPbEQsR0FDVSxrQkFBVmdCLElBQXdCQSxHQUFPLEVBQU1oQixFQUFFeUMsY0FLN0Isb0JBQVppRCxTQUNUQyxPQUFPRCxRQUFVN0UsRUFFakJhLE9BQU9iLFNBQVdBIiwiZmlsZSI6ImdweDJjem1sLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgaWYgKCFGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNCaW5hcnlTdHJpbmcpIHtcbiAgICBGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNCaW5hcnlTdHJpbmcgPSBmdW5jdGlvbiAoZmlsZURhdGEpIHtcbiAgICAgIHZhciBiaW5hcnkgPSBcIlwiO1xuICAgICAgdmFyIHB0ID0gdGhpcztcbiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB2YXIgbGVuZ3RoID0gYnl0ZXMuYnl0ZUxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgIGJpbmFyeSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICAgIC8vcHQucmVzdWx0ICAtIHJlYWRvbmx5IHNvIGFzc2lnbiBiaW5hcnlcbiAgICAgICAgcHQuY29udGVudCA9IGJpbmFyeTtcbiAgICAgICAgJChwdCkudHJpZ2dlcignb25sb2FkJyk7XG4gICAgICB9XG4gICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZURhdGEpO1xuICAgIH07XG4gIH1cblxuICB2YXIgZ3B4MmN6bWwgPSB7XG4gICAgYXN5bmMgOiBmdW5jdGlvbiAodXJsLCBjYkZ1bmMpIHtcbiAgICAgIHZhciBodHRwUmVxdWVzdDtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICBodHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgfSBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkge1xuICAgICAgICBodHRwUmVxdWVzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTEhUVFBcIik7XG4gICAgICB9XG5cbiAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGdldEdweERhdGE7XG4gICAgICBodHRwUmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgaHR0cFJlcXVlc3Quc2VuZCgpO1xuXG4gICAgICBmdW5jdGlvbiBnZXRHcHhEYXRhKCkge1xuICAgICAgICBpZiAoaHR0cFJlcXVlc3QucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgIGlmIChodHRwUmVxdWVzdC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgc2VsZi5wYXJzZUdweChodHRwUmVxdWVzdC5yZXNwb25zZVRleHQsIGZ1bmN0aW9uIChpc0Vycm9yLCByZXMpIHtcbiAgICAgICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoaXNFcnJvciwgcmVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgJ2h0dHAgcmVxdWVzdCBlcnJvcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogZ3B4IGZpbGUgdXBsb2FkIO2UhOuhnOyEuOyLsSDsspjrpqwoYXN5bmMpXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBmaWxlcyBmaWxlIE9iamVjdFxuICAgICAqL1xuICAgIGFzeW5jRnJvbUZpbGUgOiBmdW5jdGlvbiAoZmlsZXMsIGNiRnVuYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICB0aGlzLnByb2Nlc3NpbmdGaWxlcyhmaWxlcywgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuXG4gICAgICAgIGlmIChpc0Vycm9yKSB7XG4gICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIHJlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5wYXJzZUdweChyZXMsIGZ1bmN0aW9uIChjem1sRXJyb3IsIGN6bWxSZXMpIHtcbiAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhjem1sRXJyb3IsIGN6bWxSZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZ3B4IGZpbGUgb2JqZWN0IO2UhOuhnOyEuOyLsSDsspjrpqxcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbGVzIGZpbGUgT2JqZWN0XG4gICAgICovXG4gICAgcHJvY2Vzc2luZ0ZpbGVzIDogZnVuY3Rpb24gKGUsIGNiRnVuYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICB2YXIgYnJvd3NlciA9ICdjaHJvbWUnO1xuXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcztcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICBpZiAoIWUpIHtcbiAgICAgICAgICAgIGRhdGEgPSByZWFkZXIuY29udGVudDtcbiAgICAgICAgICAgIGJyb3dzZXIgPSAnaWUnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXRhID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhmYWxzZSwgZGF0YSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZXNbMF0sICdVVEYtOCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IFwiZmlsZSBpcyBub3QgZGVmaW5lZFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9maWxl7J2EIOydveqyjCDtlZzri6QuXG4gICAgICAgIC8vcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlc1swXSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHBhcnNpbmcgZ3B4IGRhdGFcbiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IGRhdGEgcGd4IHN0cmluZyBkYXRhXG4gICAgICogQHBhcmFtICB7RnVuY3Rpb259IGNiRnVuYyBjYWxsYmFjayBmdW5jdGlvblxuICAgICAqIEByZXR1cm4ge09iamVjdH0gY3ptbERhdGEgY29udmVydCBjem1sIG9iamVjdCBkYXRhXG4gICAgICovXG4gICAgcGFyc2VHcHggOiBmdW5jdGlvbiAoZGF0YSwgY2JGdW5jKSB7XG4gICAgICB2YXIgdG1wLHhtbDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy9pZiBET01QYXJzZXIgaXMgZXhpc3RcbiAgICAgICAgaWYgKHdpbmRvdy5ET01QYXJzZXIpIHtcbiAgICAgICAgICB0bXAgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgICAgeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSwgXCJ0ZXh0L3htbFwiICk7XG4gICAgICAgIH0gZWxzZSB7ICAvL0lFIHZlcnNpb25cbiAgICAgICAgICB4bWwgPSBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIik7XG4gICAgICAgICAgeG1sLmFzeW5jID0gXCJmYWxzZVwiO1xuICAgICAgICAgIHhtbC5sb2FkWE1MKGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9nZXQgZ3B4IG5vZGUgZnJvbSB4bWwgZGF0YVxuICAgICAgICB2YXIgZ3B4Tm9kZSA9IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZ3B4JylbMF07XG5cbiAgICAgICAgLy9iaW5kIGN6bWxkYXRhXG4gICAgICAgIHRoaXMuYmluZEN6bWxEYXRhKGdweE5vZGUsIGZ1bmN0aW9uIChpc0Vycm9yLCBjem1sRGF0YSkge1xuICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCBjem1sRGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZ2V0IHRleHQgZnJvbSB0YWdcbiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IHRhZyB0YWcgc3RyaW5nXG4gICAgICogQHJldHVybiB7U3RyaW5nfSB0YWdTdHIgdGFnIHN0cmluZ1xuICAgICAqL1xuICAgIGdldFRleHRUYWcgOiBmdW5jdGlvbiAodGFnKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgdGFnU3RyID0gdGFnLnRleHRDb250ZW50O1xuICAgICAgICB0YWdTdHIucmVwbGFjZSgvKF5cXHMqKXwoXFxzKiQpL2dpLCBcIlwiKTtcblxuICAgICAgICByZXR1cm4gdGFnU3RyO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogY3ptbCBkYXRhIGJpbmRpbmdcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGdweE5vZGUgZ3B4IHhtbCBkb20gbm9kZVxuICAgICAqIEByZXR1cm4ge09iamVjdH0gY3ptbERhdGEgY3ptbCBvYmplY3QgZGF0YVxuICAgICAqL1xuICAgIGJpbmRDem1sRGF0YSA6IGZ1bmN0aW9uIChncHhOb2RlLCBjYkZ1bmMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBzdW1FbGUgPSAwO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvL3htbCBwYXJzaW5nXG4gICAgICAgIHZhciBtZXRhRGF0YSA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGFkYXRhJylbMF0sIC8vbWV0YWRhdGFcbiAgICAgICAgICAgIHRya0NvbnRlbnQgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmsnKVswXSwgIC8vdHJhY2tpbmcgZGF0YVxuICAgICAgICAgICAgdHJrU2VnID0gdHJrQ29udGVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHJrc2VnJylbMF0sICAvL3Rya3NlZ1xuICAgICAgICAgICAgZWxlcyA9IHRya0NvbnRlbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2VsZScpLFxuICAgICAgICAgICAgdHJrUHRzID0gdHJrU2VnLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtwdCcpOyAgLy90cmFja2luZyBwb2ludCBhcnJheXNcblxuICAgICAgICAvL2dldCBzdGFydCB0aW1lXG4gICAgICAgIHZhciBzdGFydFRpbWUsXG4gICAgICAgICAgICBzdGFydFNlY29uZHM7XG5cbiAgICAgICAgLy9iaW5kaW5nIHRhcmdldFxuICAgICAgICB2YXIgY3ptbERhdGEgPSBbe1xuICAgICAgICAgIG5hbWUgOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgnY3JlYXRvcicpLFxuICAgICAgICAgIHZlcnNpb24gOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgndmVyc2lvbicpLFxuICAgICAgICAgIGNsb2NrIDoge1xuICAgICAgICAgICAgaW50ZXJ2YWwgOiBudWxsLFxuICAgICAgICAgICAgY3VycmVudFRpbWUgOiBzdGFydFRpbWUsXG4gICAgICAgICAgICBtdWx0aXBsaWVyIDogMSxcbiAgICAgICAgICAgIHJhbmdlIDogJ0NMQU1QRUQnXG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgcG9zaXRpb24gOiB7XG4gICAgICAgICAgICBlcG9jaCA6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGNhcnRvZ3JhcGhpY0RlZ3JlZXMgOiBbXVxuICAgICAgICAgIH1cbiAgICAgICAgfV07XG5cbiAgICAgICAgZm9yKHZhciBpZHg9MDsgaWR4IDwgZWxlcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgdmFyIGVsZUluZm8gPSBwYXJzZUZsb2F0KHNlbGYuZ2V0VGV4dFRhZyhlbGVzW2lkeF0pKTtcblxuICAgICAgICAgIHN1bUVsZSArPSBlbGVJbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGF2Z0VsZSA9IHN1bUVsZSAvIChlbGVzLmxlbmd0aCk7XG5cbiAgICAgICAgLy9zZXQgY2FydG9ncmFwaGljRGVncmVlcyBpbmZvXG4gICAgICAgIGZvcih2YXIgaWR4PTA7IGlkeCA8IHRya1B0cy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgdmFyIHRya0luZm8gPSB0cmtQdHNbaWR4XSxcbiAgICAgICAgICAgICAgbGF0ID0gcGFyc2VGbG9hdCh0cmtJbmZvLmdldEF0dHJpYnV0ZSgnbGF0JykpLCAgLy9sYXRpdHVkZVxuICAgICAgICAgICAgICBsb24gPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsb24nKSksICAvL2xvbmdpdHVkZVxuICAgICAgICAgICAgICBlbGUgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZWxlJylbMF0pLCAgLy9lbGVcbiAgICAgICAgICAgICAgdGltZSA9IHNlbGYuZ2V0VGV4dFRhZyh0cmtJbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aW1lJylbMF0pLCAgLy9pbnRlcnZhbCB0aW1lXG4gICAgICAgICAgICAgIHRhcmdldFNlY29uZHMgPSBuZXcgRGF0ZSh0aW1lKS5nZXRUaW1lKCksIC8vaW50ZXJ2YWwgdGltZSBmcm9tIHN0YXJ0U2Vjb25kc1xuICAgICAgICAgICAgICBkZWZmU2Vjb25kcyA9IChpZHggPT0gMD8gMCA6ICgodGFyZ2V0U2Vjb25kcyAtIHN0YXJ0U2Vjb25kcykgLyAxMDAwKSk7ICAvL2NvbnZlcnQgc2Vjb25kXG5cbiAgICAgICAgICBpZiAoaWR4ID09PSAwKSB7XG4gICAgICAgICAgICBzdGFydFRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgc3RhcnRTZWNvbmRzID0gdGFyZ2V0U2Vjb25kcztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjem1sRGF0YVsxXS5wb3NpdGlvbi5jYXJ0b2dyYXBoaWNEZWdyZWVzLnB1c2goZGVmZlNlY29uZHMpO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsb24pO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsYXQpO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChlbGU/IHBhcnNlRmxvYXQoZWxlKSA6IE1hdGgucm91bmQoYXZnRWxlKSk7XG5cbiAgICAgICAgICBpZiAoaWR4ID09ICh0cmtQdHMubGVuZ3RoIC0xKSkge1xuICAgICAgICAgICAgY3ptbERhdGFbMF0uY2xvY2suaW50ZXJ2YWwgPSBzdGFydFRpbWUgKyAnLycgKyB0aW1lO1xuICAgICAgICAgICAgY3ptbERhdGFbMV0uYXZhaWxhYmlsaXR5ID0gc3RhcnRUaW1lICsgJy8nICsgdGltZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoZmFsc2UsIGN6bWxEYXRhKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGdweDJjem1sO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvdy5ncHgyY3ptbCA9IGdweDJjem1sO1xuICB9XG59KSgpO1xuIl19
