"use strict";!function(){FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t="",n=this,r=new FileReader;r.onload=function(e){for(var a=new Uint8Array(r.result),i=a.byteLength,o=0;o<i;o++)t+=String.fromCharCode(a[o]);n.content=t,$(n).trigger("onload")},r.readAsArrayBuffer(e)});var e={async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(e,n){"function"==typeof t&&t(e,n)})}catch(e){"function"==typeof t&&t(!0,e.toString())}},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this;try{for(var r=e.getElementsByTagName("metadata")[0],a=r.getElementsByTagName("time")[0],i=e.getElementsByTagName("trk")[0],o=i.getElementsByTagName("trkseg")[0],s=o.getElementsByTagName("trkpt"),c=this.getTextTag(a),g=new Date(c).getTime(),p=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:c,multiplier:1,range:"CLAMPED"}},{position:{epoch:c,cartographicDegrees:[]}}],l=0;l<s.length;l++){var f=s[l],u=parseFloat(f.getAttribute("lat")),y=parseFloat(f.getAttribute("lon")),m=parseFloat(n.getTextTag(f.getElementsByTagName("ele")[0])),h=n.getTextTag(f.getElementsByTagName("time")[0]),d=(n.getTextTag(f.getElementsByTagName("extensions")[0]),new Date(h).getTime()),T=(d-g)/1e3;p[1].position.cartographicDegrees.push(T),p[1].position.cartographicDegrees.push(y),p[1].position.cartographicDegrees.push(u),p[1].position.cartographicDegrees.push(m),l==s.length-1&&(p[0].clock.interval=c+"/"+h,p[1].availability=c+"/"+h)}"function"==typeof t&&t(!1,p)}catch(e){"function"==typeof t&&t(!0,e.toString())}}};"undefined"!=typeof exports?module.exports=e:window.gpx2czml=e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdweDJjem1sLmpzIl0sIm5hbWVzIjpbIkZpbGVSZWFkZXIiLCJwcm90b3R5cGUiLCJyZWFkQXNCaW5hcnlTdHJpbmciLCJmaWxlRGF0YSIsImJpbmFyeSIsInB0IiwidGhpcyIsInJlYWRlciIsIm9ubG9hZCIsImUiLCJieXRlcyIsIlVpbnQ4QXJyYXkiLCJyZXN1bHQiLCJsZW5ndGgiLCJieXRlTGVuZ3RoIiwiaSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImNvbnRlbnQiLCIkIiwidHJpZ2dlciIsInJlYWRBc0FycmF5QnVmZmVyIiwiZ3B4MmN6bWwiLCJhc3luYyIsInVybCIsImNiRnVuYyIsImdldEdweERhdGEiLCJodHRwUmVxdWVzdCIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJzZWxmIiwicGFyc2VHcHgiLCJyZXNwb25zZVRleHQiLCJpc0Vycm9yIiwicmVzIiwid2luZG93IiwiWE1MSHR0cFJlcXVlc3QiLCJBY3RpdmVYT2JqZWN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwib3BlbiIsInNlbmQiLCJhc3luY0Zyb21GaWxlIiwiZmlsZXMiLCJwcm9jZXNzaW5nRmlsZXMiLCJjem1sRXJyb3IiLCJjem1sUmVzIiwiYnJvd3NlciIsInRhcmdldCIsImRhdGEiLCJyZWFkQXNUZXh0IiwidG9TdHJpbmciLCJ0bXAiLCJ4bWwiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJsb2FkWE1MIiwiZ3B4Tm9kZSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiYmluZEN6bWxEYXRhIiwiY3ptbERhdGEiLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwibWV0YURhdGEiLCJ0aW1lRGF0YSIsInRya0NvbnRlbnQiLCJ0cmtTZWciLCJ0cmtQdHMiLCJzdGFydFRpbWUiLCJzdGFydFNlY29uZHMiLCJEYXRlIiwiZ2V0VGltZSIsIm5hbWUiLCJnZXRBdHRyaWJ1dGUiLCJ2ZXJzaW9uIiwiY2xvY2siLCJpbnRlcnZhbCIsImN1cnJlbnRUaW1lIiwibXVsdGlwbGllciIsInJhbmdlIiwicG9zaXRpb24iLCJlcG9jaCIsImNhcnRvZ3JhcGhpY0RlZ3JlZXMiLCJpZHgiLCJ0cmtJbmZvIiwibGF0IiwicGFyc2VGbG9hdCIsImxvbiIsImVsZSIsInRpbWUiLCJ0YXJnZXRTZWNvbmRzIiwiZGVmZlNlY29uZHMiLCJwdXNoIiwiYXZhaWxhYmlsaXR5IiwiZXhwb3J0cyIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUNPQSxXQUFXQyxVQUFVQyxxQkFDeEJGLFdBQVdDLFVBQVVDLG1CQUFxQixTQUFVQyxHQUNsRCxHQUFJQyxHQUFTLEdBQ1RDLEVBQUtDLEtBQ0xDLEVBQVMsR0FBSVAsV0FDakJPLEdBQU9DLE9BQVMsU0FBVUMsR0FHeEIsSUFBSyxHQUZEQyxHQUFRLEdBQUlDLFlBQVdKLEVBQU9LLFFBQzlCQyxFQUFTSCxFQUFNSSxXQUNWQyxFQUFJLEVBQUdBLEVBQUlGLEVBQVFFLElBQzFCWCxHQUFVWSxPQUFPQyxhQUFhUCxFQUFNSyxHQUd0Q1YsR0FBR2EsUUFBVWQsRUFDYmUsRUFBRWQsR0FBSWUsUUFBUSxXQUVoQmIsRUFBT2Msa0JBQWtCbEIsSUFJN0IsSUFBSW1CLElBQ0ZDLE1BQVEsU0FBVUMsRUFBS0MsR0FjckIsUUFBU0MsS0FDd0IsSUFBM0JDLEVBQVlDLGFBQ2EsTUFBdkJELEVBQVlFLE9BQ2RDLEVBQUtDLFNBQVNKLEVBQVlLLGFBQWMsU0FBVUMsRUFBU0MsR0FDdEMsa0JBQVZULElBQXdCQSxFQUFPUSxFQUFTQyxLQUdsQyxrQkFBVlQsSUFBd0JBLEdBQU8sRUFBTSx1QkFwQmxELEdBQUlFLEdBQ0FHLEVBQU94QixJQUVQNkIsUUFBT0MsZUFDVFQsRUFBYyxHQUFJUyxnQkFDVEQsT0FBT0UsZ0JBQ2hCVixFQUFjLEdBQUlVLGVBQWMsc0JBR2xDVixFQUFZVyxtQkFBcUJaLEVBQ2pDQyxFQUFZWSxLQUFLLE1BQU9mLEdBQ3hCRyxFQUFZYSxRQWtCZEMsY0FBZ0IsU0FBVUMsRUFBT2pC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UyxHQUFHdUIsU0FBU0Usb0JBQW9CVSxLQUFLSixHQUUxQ0wsR0FBUWhCLEVBQU94RCxPQUFRLElBQ3pCOEMsRUFBUyxHQUFHa0IsTUFBTUMsU0FBV1IsRUFBWSxJQUFNcUIsRUFDL0NoQyxFQUFTLEdBQUdvQyxhQUFlekIsRUFBWSxJQUFNcUIsR0FJaEMsa0JBQVZsRSxJQUF3QkEsR0FBTyxFQUFPa0MsR0FDN0MsTUFBT2xELEdBQ1Usa0JBQVZnQixJQUF3QkEsR0FBTyxFQUFNaEIsRUFBRXlDLGNBSzdCLG9CQUFaOEMsU0FDVEMsT0FBT0QsUUFBVTFFLEVBRWpCYSxPQUFPYixTQUFXQSIsImZpbGUiOiJncHgyY3ptbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGlmICghRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQmluYXJ5U3RyaW5nKSB7XG4gICAgRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQmluYXJ5U3RyaW5nID0gZnVuY3Rpb24gKGZpbGVEYXRhKSB7XG4gICAgICB2YXIgYmluYXJ5ID0gXCJcIjtcbiAgICAgIHZhciBwdCA9IHRoaXM7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmJ5dGVMZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgICAvL3B0LnJlc3VsdCAgLSByZWFkb25seSBzbyBhc3NpZ24gYmluYXJ5XG4gICAgICAgIHB0LmNvbnRlbnQgPSBiaW5hcnk7XG4gICAgICAgICQocHQpLnRyaWdnZXIoJ29ubG9hZCcpO1xuICAgICAgfVxuICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGVEYXRhKTtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGdweDJjem1sID0ge1xuICAgIGFzeW5jIDogZnVuY3Rpb24gKHVybCwgY2JGdW5jKSB7XG4gICAgICB2YXIgaHR0cFJlcXVlc3Q7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgaHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIH0gZWxzZSBpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHtcbiAgICAgICAgaHR0cFJlcXVlc3QgPSBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxIVFRQXCIpO1xuICAgICAgfVxuXG4gICAgICBodHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBnZXRHcHhEYXRhO1xuICAgICAgaHR0cFJlcXVlc3Qub3BlbignR0VUJywgdXJsKTtcbiAgICAgIGh0dHBSZXF1ZXN0LnNlbmQoKTtcblxuICAgICAgZnVuY3Rpb24gZ2V0R3B4RGF0YSgpIHtcbiAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHNlbGYucGFyc2VHcHgoaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0LCBmdW5jdGlvbiAoaXNFcnJvciwgcmVzKSB7XG4gICAgICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIHJlcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsICdodHRwIHJlcXVlc3QgZXJyb3InKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIGdweCBmaWxlIHVwbG9hZCDtlITroZzshLjsi7Eg7LKY66asKGFzeW5jKVxuICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgKi9cbiAgICBhc3luY0Zyb21GaWxlIDogZnVuY3Rpb24gKGZpbGVzLCBjYkZ1bmMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgdGhpcy5wcm9jZXNzaW5nRmlsZXMoZmlsZXMsIGZ1bmN0aW9uIChpc0Vycm9yLCByZXMpIHtcblxuICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYucGFyc2VHcHgocmVzLCBmdW5jdGlvbiAoY3ptbEVycm9yLCBjem1sUmVzKSB7XG4gICAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoY3ptbEVycm9yLCBjem1sUmVzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGdweCBmaWxlIG9iamVjdCDtlITroZzshLjsi7Eg7LKY66asXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBmaWxlcyBmaWxlIE9iamVjdFxuICAgICAqL1xuICAgIHByb2Nlc3NpbmdGaWxlcyA6IGZ1bmN0aW9uIChlLCBjYkZ1bmMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgdmFyIGJyb3dzZXIgPSAnY2hyb21lJztcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXM7XG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgaWYgKCFlKSB7XG4gICAgICAgICAgICBkYXRhID0gcmVhZGVyLmNvbnRlbnQ7XG4gICAgICAgICAgICBicm93c2VyID0gJ2llJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YSA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoZmFsc2UsIGRhdGEpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGVzWzBdLCAnVVRGLTgnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBcImZpbGUgaXMgbm90IGRlZmluZWRcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZmlsZeydhCDsnb3qsowg7ZWc64ukLlxuICAgICAgICAvL3JlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZXNbMF0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBwYXJzaW5nIGdweCBkYXRhXG4gICAgICogQHBhcmFtICB7U3RyaW5nfSBkYXRhIHBneCBzdHJpbmcgZGF0YVxuICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYkZ1bmMgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGN6bWxEYXRhIGNvbnZlcnQgY3ptbCBvYmplY3QgZGF0YVxuICAgICAqL1xuICAgIHBhcnNlR3B4IDogZnVuY3Rpb24gKGRhdGEsIGNiRnVuYykge1xuICAgICAgdmFyIHRtcCx4bWw7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vaWYgRE9NUGFyc2VyIGlzIGV4aXN0XG4gICAgICAgIGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7XG4gICAgICAgICAgdG1wID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgICAgIHhtbCA9IHRtcC5wYXJzZUZyb21TdHJpbmcoIGRhdGEsIFwidGV4dC94bWxcIiApO1xuICAgICAgICB9IGVsc2UgeyAgLy9JRSB2ZXJzaW9uXG4gICAgICAgICAgeG1sID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpO1xuICAgICAgICAgIHhtbC5hc3luYyA9IFwiZmFsc2VcIjtcbiAgICAgICAgICB4bWwubG9hZFhNTChkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vZ2V0IGdweCBub2RlIGZyb20geG1sIGRhdGFcbiAgICAgICAgdmFyIGdweE5vZGUgPSB4bWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2dweCcpWzBdO1xuXG4gICAgICAgIC8vYmluZCBjem1sZGF0YVxuICAgICAgICB0aGlzLmJpbmRDem1sRGF0YShncHhOb2RlLCBmdW5jdGlvbiAoaXNFcnJvciwgY3ptbERhdGEpIHtcbiAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoaXNFcnJvciwgY3ptbERhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGdldCB0ZXh0IGZyb20gdGFnXG4gICAgICogQHBhcmFtICB7U3RyaW5nfSB0YWcgdGFnIHN0cmluZ1xuICAgICAqIEByZXR1cm4ge1N0cmluZ30gdGFnU3RyIHRhZyBzdHJpbmdcbiAgICAgKi9cbiAgICBnZXRUZXh0VGFnIDogZnVuY3Rpb24gKHRhZykge1xuICAgICAgLy92YXIgdGFnU3RyID0gdGFnLmlubmVySFRNTC5yZXBsYWNlKC88W14+XSo+L2csIFwiXCIpO1xuICAgICAgdmFyIHRhZ1N0ciA9IHRhZy50ZXh0Q29udGVudDtcbiAgICAgIHRhZ1N0ci5yZXBsYWNlKC8oXlxccyopfChcXHMqJCkvZ2ksIFwiXCIpO1xuXG4gICAgICByZXR1cm4gdGFnU3RyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBjem1sIGRhdGEgYmluZGluZ1xuICAgICAqIEBwYXJhbSAge09iamVjdH0gZ3B4Tm9kZSBncHggeG1sIGRvbSBub2RlXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjem1sIG9iamVjdCBkYXRhXG4gICAgICovXG4gICAgYmluZEN6bWxEYXRhIDogZnVuY3Rpb24gKGdweE5vZGUsIGNiRnVuYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvL3htbCBwYXJzaW5nXG4gICAgICAgIHZhciBtZXRhRGF0YSA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGFkYXRhJylbMF0sIC8vbWV0YWRhdGFcbiAgICAgICAgICAgIHRpbWVEYXRhID0gbWV0YURhdGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpbWUnKVswXSwgIC8vdGltZVxuICAgICAgICAgICAgdHJrQ29udGVudCA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyaycpWzBdLCAgLy90cmFja2luZyBkYXRhXG4gICAgICAgICAgICB0cmtTZWcgPSB0cmtDb250ZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtzZWcnKVswXSwgIC8vdHJrc2VnXG4gICAgICAgICAgICB0cmtQdHMgPSB0cmtTZWcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rya3B0Jyk7ICAvL3RyYWNraW5nIHBvaW50IGFycmF5c1xuXG4gICAgICAgIC8vZ2V0IHN0YXJ0IHRpbWVcbiAgICAgICAgdmFyIHN0YXJ0VGltZSA9IHRoaXMuZ2V0VGV4dFRhZyh0aW1lRGF0YSksXG4gICAgICAgICAgICBzdGFydFNlY29uZHMgPSBuZXcgRGF0ZShzdGFydFRpbWUpLmdldFRpbWUoKTtcblxuICAgICAgICAvL2JpbmRpbmcgdGFyZ2V0XG4gICAgICAgIHZhciBjem1sRGF0YSA9IFt7XG4gICAgICAgICAgbmFtZSA6IGdweE5vZGUuZ2V0QXR0cmlidXRlKCdjcmVhdG9yJyksXG4gICAgICAgICAgdmVyc2lvbiA6IGdweE5vZGUuZ2V0QXR0cmlidXRlKCd2ZXJzaW9uJyksXG4gICAgICAgICAgY2xvY2sgOiB7XG4gICAgICAgICAgICBpbnRlcnZhbCA6IG51bGwsXG4gICAgICAgICAgICBjdXJyZW50VGltZSA6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgIG11bHRpcGxpZXIgOiAxLFxuICAgICAgICAgICAgcmFuZ2UgOiAnQ0xBTVBFRCdcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBwb3NpdGlvbiA6IHtcbiAgICAgICAgICAgIGVwb2NoIDogc3RhcnRUaW1lLFxuICAgICAgICAgICAgY2FydG9ncmFwaGljRGVncmVlcyA6IFtdXG4gICAgICAgICAgfVxuICAgICAgICB9XTtcblxuICAgICAgICAvL3NldCBjYXJ0b2dyYXBoaWNEZWdyZWVzIGluZm9cbiAgICAgICAgZm9yKHZhciBpZHg9MDsgaWR4IDwgdHJrUHRzLmxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICB2YXIgdHJrSW5mbyA9IHRya1B0c1tpZHhdLFxuICAgICAgICAgICAgICBsYXQgPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsYXQnKSksICAvL2xhdGl0dWRlXG4gICAgICAgICAgICAgIGxvbiA9IHBhcnNlRmxvYXQodHJrSW5mby5nZXRBdHRyaWJ1dGUoJ2xvbicpKSwgIC8vbG9uZ2l0dWRlXG4gICAgICAgICAgICAgIGVsZSA9IHBhcnNlRmxvYXQoc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2VsZScpWzBdKSksICAvL2VsZVxuICAgICAgICAgICAgICB0aW1lID0gc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpbWUnKVswXSksICAvL2ludGVydmFsIHRpbWVcbiAgICAgICAgICAgICAgZXh0ZW5zaW9ucyA9IHNlbGYuZ2V0VGV4dFRhZyh0cmtJbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdleHRlbnNpb25zJylbMF0pLCAgLy9leHRlbnNpb25zXG4gICAgICAgICAgICAgIHRhcmdldFNlY29uZHMgPSBuZXcgRGF0ZSh0aW1lKS5nZXRUaW1lKCksIC8vaW50ZXJ2YWwgdGltZSBmcm9tIHN0YXJ0U2Vjb25kc1xuICAgICAgICAgICAgICBkZWZmU2Vjb25kcyA9ICh0YXJnZXRTZWNvbmRzIC0gc3RhcnRTZWNvbmRzKSAvIDEwMDA7ICAvL2NvbnZlcnQgc2Vjb25kXG5cbiAgICAgICAgICBjem1sRGF0YVsxXS5wb3NpdGlvbi5jYXJ0b2dyYXBoaWNEZWdyZWVzLnB1c2goZGVmZlNlY29uZHMpO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsb24pO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChsYXQpO1xuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChlbGUpO1xuXG4gICAgICAgICAgaWYgKGlkeCA9PSAodHJrUHRzLmxlbmd0aCAtMSkpIHtcbiAgICAgICAgICAgIGN6bWxEYXRhWzBdLmNsb2NrLmludGVydmFsID0gc3RhcnRUaW1lICsgJy8nICsgdGltZTtcbiAgICAgICAgICAgIGN6bWxEYXRhWzFdLmF2YWlsYWJpbGl0eSA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBjem1sRGF0YSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBncHgyY3ptbDtcbiAgfSBlbHNlIHtcbiAgICB3aW5kb3cuZ3B4MmN6bWwgPSBncHgyY3ptbDtcbiAgfVxufSkoKTtcbiJdfQ==
