"use strict";!function(){FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t="",n=this,r=new FileReader;r.onload=function(e){for(var a=new Uint8Array(r.result),o=a.byteLength,i=0;i<o;i++)t+=String.fromCharCode(a[i]);n.content=t,$(n).trigger("onload")},r.readAsArrayBuffer(e)});var e={async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(e,n){"function"==typeof t&&t(e,n)})}catch(e){"function"==typeof t&&t(!0,e.toString())}},getTextTag:function(e){var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t},bindCzmlData:function(e,t){var n=this;try{for(var r=e.getElementsByTagName("metadata")[0],a=r.getElementsByTagName("time")[0],o=e.getElementsByTagName("trk")[0],i=o.getElementsByTagName("trkseg")[0],s=i.getElementsByTagName("trkpt"),c=this.getTextTag(a),g=new Date(c).getTime(),p=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:c,multiplier:1,range:"CLAMPED"}},{position:{cartographicDegrees:[]}}],f=0;f<s.length;f++){var l=s[f],u=parseFloat(l.getAttribute("lat")),m=parseFloat(l.getAttribute("lon")),y=parseFloat(n.getTextTag(l.getElementsByTagName("ele")[0])),d=n.getTextTag(l.getElementsByTagName("time")[0]),h=(n.getTextTag(l.getElementsByTagName("extensions")[0]),new Date(d).getTime()),T=(h-g)/1e3;p[1].position.cartographicDegrees.push(T),p[1].position.cartographicDegrees.push(u),p[1].position.cartographicDegrees.push(m),p[1].position.cartographicDegrees.push(y),f==s.length-1&&(p[0].clock.interval=c+"/"+d)}"function"==typeof t&&t(!1,p)}catch(e){"function"==typeof t&&t(!0,e.toString())}}};"undefined"!=typeof exports?module.exports=e:window.gpx2czml=e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdweDJjem1sLmpzIl0sIm5hbWVzIjpbIkZpbGVSZWFkZXIiLCJwcm90b3R5cGUiLCJyZWFkQXNCaW5hcnlTdHJpbmciLCJmaWxlRGF0YSIsImJpbmFyeSIsInB0IiwidGhpcyIsInJlYWRlciIsIm9ubG9hZCIsImUiLCJieXRlcyIsIlVpbnQ4QXJyYXkiLCJyZXN1bHQiLCJsZW5ndGgiLCJieXRlTGVuZ3RoIiwiaSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImNvbnRlbnQiLCIkIiwidHJpZ2dlciIsInJlYWRBc0FycmF5QnVmZmVyIiwiZ3B4MmN6bWwiLCJhc3luYyIsInVybCIsImNiRnVuYyIsImdldEdweERhdGEiLCJodHRwUmVxdWVzdCIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJzZWxmIiwicGFyc2VHcHgiLCJyZXNwb25zZVRleHQiLCJpc0Vycm9yIiwicmVzIiwid2luZG93IiwiWE1MSHR0cFJlcXVlc3QiLCJBY3RpdmVYT2JqZWN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwib3BlbiIsInNlbmQiLCJhc3luY0Zyb21GaWxlIiwiZmlsZXMiLCJwcm9jZXNzaW5nRmlsZXMiLCJjem1sRXJyb3IiLCJjem1sUmVzIiwiYnJvd3NlciIsInRhcmdldCIsImRhdGEiLCJyZWFkQXNUZXh0IiwidG9TdHJpbmciLCJ0bXAiLCJ4bWwiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJsb2FkWE1MIiwiZ3B4Tm9kZSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiYmluZEN6bWxEYXRhIiwiY3ptbERhdGEiLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwibWV0YURhdGEiLCJ0aW1lRGF0YSIsInRya0NvbnRlbnQiLCJ0cmtTZWciLCJ0cmtQdHMiLCJzdGFydFRpbWUiLCJzdGFydFNlY29uZHMiLCJEYXRlIiwiZ2V0VGltZSIsIm5hbWUiLCJnZXRBdHRyaWJ1dGUiLCJ2ZXJzaW9uIiwiY2xvY2siLCJpbnRlcnZhbCIsImN1cnJlbnRUaW1lIiwibXVsdGlwbGllciIsInJhbmdlIiwicG9zaXRpb24iLCJjYXJ0b2dyYXBoaWNEZWdyZWVzIiwiaWR4IiwidHJrSW5mbyIsImxhdCIsInBhcnNlRmxvYXQiLCJsb24iLCJlbGUiLCJ0aW1lIiwidGFyZ2V0U2Vjb25kcyIsImRlZmZTZWNvbmRzIiwicHVzaCIsImV4cG9ydHMiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FDT0EsV0FBV0MsVUFBVUMscUJBQ3hCRixXQUFXQyxVQUFVQyxtQkFBcUIsU0FBVUMsR0FDbEQsR0FBSUMsR0FBUyxHQUNUQyxFQUFLQyxLQUNMQyxFQUFTLEdBQUlQLFdBQ2pCTyxHQUFPQyxPQUFTLFNBQVVDLEdBR3hCLElBQUssR0FGREMsR0FBUSxHQUFJQyxZQUFXSixFQUFPSyxRQUM5QkMsRUFBU0gsRUFBTUksV0FDVkMsRUFBSSxFQUFHQSxFQUFJRixFQUFRRSxJQUMxQlgsR0FBVVksT0FBT0MsYUFBYVAsRUFBTUssR0FHdENWLEdBQUdhLFFBQVVkLEVBQ2JlLEVBQUVkLEdBQUllLFFBQVEsV0FFaEJiLEVBQU9jLGtCQUFrQmxCLElBSTdCLElBQUltQixJQUNGQyxNQUFRLFNBQVVDLEVBQUtDLEdBY3JCLFFBQVNDLEtBQ3dCLElBQTNCQyxFQUFZQyxhQUNhLE1BQXZCRCxFQUFZRSxPQUNkQyxFQUFLQyxTQUFTSixFQUFZSyxhQUFjLFNBQVVDLEVBQVNDLEdBQ3RDLGtCQUFWVCxJQUF3QkEsRUFBT1EsRUFBU0MsS0FHbEMsa0JBQVZULElBQXdCQSxHQUFPLEVBQU0sdUJBcEJsRCxHQUFJRSxHQUNBRyxFQUFPeEIsSUFFUDZCLFFBQU9DLGVBQ1RULEVBQWMsR0FBSVMsZ0JBQ1RELE9BQU9FLGdCQUNoQlYsRUFBYyxHQUFJVSxlQUFjLHNCQUdsQ1YsRUFBWVcsbUJBQXFCWixFQUNqQ0MsRUFBWVksS0FBSyxNQUFPZixHQUN4QkcsRUFBWWEsUUFrQmRDLGNBQWdCLFNBQVVDLEVBQU9qQixHQUMvQixHQUFJSyxHQUFPeEIsSUFF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QUFRZixFQUFPeEQsT0FBUSxJQUN6QjhDLEVBQVMsR0FBR2tCLE1BQU1DLFNBQVdSLEVBQVksSUFBTW9CLEdBSWxDLGtCQUFWakUsSUFBd0JBLEdBQU8sRUFBT2tDLEdBQzdDLE1BQU9sRCxHQUNVLGtCQUFWZ0IsSUFBd0JBLEdBQU8sRUFBTWhCLEVBQUV5QyxjQUs3QixvQkFBWjRDLFNBQ1RDLE9BQU9ELFFBQVV4RSxFQUVqQmEsT0FBT2IsU0FBV0EiLCJmaWxlIjoiZ3B4MmN6bWwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICBpZiAoIUZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZykge1xuICAgIEZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChmaWxlRGF0YSkge1xuICAgICAgdmFyIGJpbmFyeSA9IFwiXCI7XG4gICAgICB2YXIgcHQgPSB0aGlzO1xuICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocmVhZGVyLnJlc3VsdCk7XG4gICAgICAgIHZhciBsZW5ndGggPSBieXRlcy5ieXRlTGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgICAgLy9wdC5yZXN1bHQgIC0gcmVhZG9ubHkgc28gYXNzaWduIGJpbmFyeVxuICAgICAgICBwdC5jb250ZW50ID0gYmluYXJ5O1xuICAgICAgICAkKHB0KS50cmlnZ2VyKCdvbmxvYWQnKTtcbiAgICAgIH1cbiAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlRGF0YSk7XG4gICAgfTtcbiAgfVxuXG4gIHZhciBncHgyY3ptbCA9IHtcbiAgICBhc3luYyA6IGZ1bmN0aW9uICh1cmwsIGNiRnVuYykge1xuICAgICAgdmFyIGh0dHBSZXF1ZXN0O1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICB9IGVsc2UgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7XG4gICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MSFRUUFwiKTtcbiAgICAgIH1cblxuICAgICAgaHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZ2V0R3B4RGF0YTtcbiAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG5cbiAgICAgIGZ1bmN0aW9uIGdldEdweERhdGEoKSB7XG4gICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBzZWxmLnBhcnNlR3B4KGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dCwgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCAnaHR0cCByZXF1ZXN0IGVycm9yJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBncHggZmlsZSB1cGxvYWQg7ZSE66Gc7IS47IuxIOyymOumrChhc3luYylcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbGVzIGZpbGUgT2JqZWN0XG4gICAgICovXG4gICAgYXN5bmNGcm9tRmlsZSA6IGZ1bmN0aW9uIChmaWxlcywgY2JGdW5jKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzKGZpbGVzLCBmdW5jdGlvbiAoaXNFcnJvciwgcmVzKSB7XG5cbiAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoaXNFcnJvciwgcmVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLnBhcnNlR3B4KHJlcywgZnVuY3Rpb24gKGN6bWxFcnJvciwgY3ptbFJlcykge1xuICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGN6bWxFcnJvciwgY3ptbFJlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBncHggZmlsZSBvYmplY3Qg7ZSE66Gc7IS47IuxIOyymOumrFxuICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgKi9cbiAgICBwcm9jZXNzaW5nRmlsZXMgOiBmdW5jdGlvbiAoZSwgY2JGdW5jKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHZhciBicm93c2VyID0gJ2Nocm9tZSc7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciBkYXRhO1xuICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgZGF0YSA9IHJlYWRlci5jb250ZW50O1xuICAgICAgICAgICAgYnJvd3NlciA9ICdpZSc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBkYXRhKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlc1swXSwgJ1VURi04Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgXCJmaWxlIGlzIG5vdCBkZWZpbmVkXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL2ZpbGXsnYQg7J296rKMIO2VnOuLpC5cbiAgICAgICAgLy9yZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGVzWzBdKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICB9XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogcGFyc2luZyBncHggZGF0YVxuICAgICAqIEBwYXJhbSAge1N0cmluZ30gZGF0YSBwZ3ggc3RyaW5nIGRhdGFcbiAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2JGdW5jIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjb252ZXJ0IGN6bWwgb2JqZWN0IGRhdGFcbiAgICAgKi9cbiAgICBwYXJzZUdweCA6IGZ1bmN0aW9uIChkYXRhLCBjYkZ1bmMpIHtcbiAgICAgIHZhciB0bXAseG1sO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvL2lmIERPTVBhcnNlciBpcyBleGlzdFxuICAgICAgICBpZiAod2luZG93LkRPTVBhcnNlcikge1xuICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICB4bWwgPSB0bXAucGFyc2VGcm9tU3RyaW5nKCBkYXRhLCBcInRleHQveG1sXCIgKTtcbiAgICAgICAgfSBlbHNlIHsgIC8vSUUgdmVyc2lvblxuICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcbiAgICAgICAgICB4bWwuYXN5bmMgPSBcImZhbHNlXCI7XG4gICAgICAgICAgeG1sLmxvYWRYTUwoZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCBncHggbm9kZSBmcm9tIHhtbCBkYXRhXG4gICAgICAgIHZhciBncHhOb2RlID0geG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdncHgnKVswXTtcblxuICAgICAgICAvL2JpbmQgY3ptbGRhdGFcbiAgICAgICAgdGhpcy5iaW5kQ3ptbERhdGEoZ3B4Tm9kZSwgZnVuY3Rpb24gKGlzRXJyb3IsIGN6bWxEYXRhKSB7XG4gICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIGN6bWxEYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBnZXQgdGV4dCBmcm9tIHRhZ1xuICAgICAqIEBwYXJhbSAge1N0cmluZ30gdGFnIHRhZyBzdHJpbmdcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRhZ1N0ciB0YWcgc3RyaW5nXG4gICAgICovXG4gICAgZ2V0VGV4dFRhZyA6IGZ1bmN0aW9uICh0YWcpIHtcbiAgICAgIC8vdmFyIHRhZ1N0ciA9IHRhZy5pbm5lckhUTUwucmVwbGFjZSgvPFtePl0qPi9nLCBcIlwiKTtcbiAgICAgIHZhciB0YWdTdHIgPSB0YWcudGV4dENvbnRlbnQ7XG4gICAgICB0YWdTdHIucmVwbGFjZSgvKF5cXHMqKXwoXFxzKiQpL2dpLCBcIlwiKTtcblxuICAgICAgcmV0dXJuIHRhZ1N0cjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogY3ptbCBkYXRhIGJpbmRpbmdcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGdweE5vZGUgZ3B4IHhtbCBkb20gbm9kZVxuICAgICAqIEByZXR1cm4ge09iamVjdH0gY3ptbERhdGEgY3ptbCBvYmplY3QgZGF0YVxuICAgICAqL1xuICAgIGJpbmRDem1sRGF0YSA6IGZ1bmN0aW9uIChncHhOb2RlLCBjYkZ1bmMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy94bWwgcGFyc2luZ1xuICAgICAgICB2YXIgbWV0YURhdGEgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdtZXRhZGF0YScpWzBdLCAvL21ldGFkYXRhXG4gICAgICAgICAgICB0aW1lRGF0YSA9IG1ldGFEYXRhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aW1lJylbMF0sICAvL3RpbWVcbiAgICAgICAgICAgIHRya0NvbnRlbnQgPSBncHhOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmsnKVswXSwgIC8vdHJhY2tpbmcgZGF0YVxuICAgICAgICAgICAgdHJrU2VnID0gdHJrQ29udGVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHJrc2VnJylbMF0sICAvL3Rya3NlZ1xuICAgICAgICAgICAgdHJrUHRzID0gdHJrU2VnLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtwdCcpOyAgLy90cmFja2luZyBwb2ludCBhcnJheXNcblxuICAgICAgICAvL2dldCBzdGFydCB0aW1lXG4gICAgICAgIHZhciBzdGFydFRpbWUgPSB0aGlzLmdldFRleHRUYWcodGltZURhdGEpLFxuICAgICAgICAgICAgc3RhcnRTZWNvbmRzID0gbmV3IERhdGUoc3RhcnRUaW1lKS5nZXRUaW1lKCk7XG5cbiAgICAgICAgLy9iaW5kaW5nIHRhcmdldFxuICAgICAgICB2YXIgY3ptbERhdGEgPSBbe1xuICAgICAgICAgIG5hbWUgOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgnY3JlYXRvcicpLFxuICAgICAgICAgIHZlcnNpb24gOiBncHhOb2RlLmdldEF0dHJpYnV0ZSgndmVyc2lvbicpLFxuICAgICAgICAgIGNsb2NrIDoge1xuICAgICAgICAgICAgaW50ZXJ2YWwgOiBudWxsLFxuICAgICAgICAgICAgY3VycmVudFRpbWUgOiBzdGFydFRpbWUsXG4gICAgICAgICAgICBtdWx0aXBsaWVyIDogMSxcbiAgICAgICAgICAgIHJhbmdlIDogJ0NMQU1QRUQnXG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgcG9zaXRpb24gOiB7XG4gICAgICAgICAgICBjYXJ0b2dyYXBoaWNEZWdyZWVzIDogW11cbiAgICAgICAgICB9XG4gICAgICAgIH1dO1xuXG4gICAgICAgIC8vc2V0IGNhcnRvZ3JhcGhpY0RlZ3JlZXMgaW5mb1xuICAgICAgICBmb3IodmFyIGlkeD0wOyBpZHggPCB0cmtQdHMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgIHZhciB0cmtJbmZvID0gdHJrUHRzW2lkeF0sXG4gICAgICAgICAgICAgIGxhdCA9IHBhcnNlRmxvYXQodHJrSW5mby5nZXRBdHRyaWJ1dGUoJ2xhdCcpKSwgIC8vbGF0aXR1ZGVcbiAgICAgICAgICAgICAgbG9uID0gcGFyc2VGbG9hdCh0cmtJbmZvLmdldEF0dHJpYnV0ZSgnbG9uJykpLCAgLy9sb25naXR1ZGVcbiAgICAgICAgICAgICAgZWxlID0gcGFyc2VGbG9hdChzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZWxlJylbMF0pKSwgIC8vZWxlXG4gICAgICAgICAgICAgIHRpbWUgPSBzZWxmLmdldFRleHRUYWcodHJrSW5mby5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGltZScpWzBdKSwgIC8vaW50ZXJ2YWwgdGltZVxuICAgICAgICAgICAgICBleHRlbnNpb25zID0gc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2V4dGVuc2lvbnMnKVswXSksICAvL2V4dGVuc2lvbnNcbiAgICAgICAgICAgICAgdGFyZ2V0U2Vjb25kcyA9IG5ldyBEYXRlKHRpbWUpLmdldFRpbWUoKSwgLy9pbnRlcnZhbCB0aW1lIGZyb20gc3RhcnRTZWNvbmRzXG4gICAgICAgICAgICAgIGRlZmZTZWNvbmRzID0gKHRhcmdldFNlY29uZHMgLSBzdGFydFNlY29uZHMpIC8gMTAwMDsgIC8vY29udmVydCBzZWNvbmRcblxuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChkZWZmU2Vjb25kcyk7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxhdCk7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxvbik7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGVsZSk7XG5cbiAgICAgICAgICBpZiAoaWR4ID09ICh0cmtQdHMubGVuZ3RoIC0xKSkge1xuICAgICAgICAgICAgY3ptbERhdGFbMF0uY2xvY2suaW50ZXJ2YWwgPSBzdGFydFRpbWUgKyAnLycgKyB0aW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhmYWxzZSwgY3ptbERhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZ3B4MmN6bWw7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmdweDJjem1sID0gZ3B4MmN6bWw7XG4gIH1cbn0pKCk7XG4iXX0=
