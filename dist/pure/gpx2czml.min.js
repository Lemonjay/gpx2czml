"use strict";!function(){FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(t){var e="",n=this,r=new FileReader;r.onload=function(t){for(var a=new Uint8Array(r.result),o=a.byteLength,i=0;i<o;i++)e+=String.fromCharCode(a[i]);n.content=e,$(n).trigger("onload")},r.readAsArrayBuffer(t)});var t={async:function(t,e){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(t,n){"function"==typeof e&&e(t,n)}):"function"==typeof e&&e(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",t),r.send()},asyncFromFile:function(t,e){var n=this;this.processingFiles(t,function(t,r){t?"function"==typeof e&&e(t,r):n.parseGpx(r,function(t,n){"function"==typeof e&&e(t,n)})})},processingFiles:function(t,e){var n=new FileReader,r="chrome";try{var a=t.target.files;if(n.onload=function(t){var a;t?a=t.target.result:(a=n.content,r="ie"),"function"==typeof e&&e(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(t){"function"==typeof e&&e(!0,t.toString())}},parseGpx:function(t,e){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(t,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(t));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(t,n){"function"==typeof e&&e(t,n)})}catch(t){"function"==typeof e&&e(!0,t.toString())}},getTextTag:function(t){try{var e=t.textContent;return e.replace(/(^\s*)|(\s*$)/gi,""),e}catch(t){return null}},bindCzmlData:function(t,e){var n=this,r=0;try{for(var a,o,i=(t.getElementsByTagName("metadata")[0],t.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=s.getElementsByTagName("trkpt"),g=[{name:t.getAttribute("creator"),version:t.getAttribute("version"),clock:{interval:null,currentTime:a,multiplier:1,range:"CLAMPED"}},{position:{epoch:a,cartographicDegrees:[]}}],p=0;p<c.length;p++){var l=c[p],f=parseFloat(l.getAttribute("lat")),u=parseFloat(l.getAttribute("lon")),y=n.getTextTag(l.getElementsByTagName("ele")[0]),h=n.getTextTag(l.getElementsByTagName("time")[0]),m=new Date(h).getTime(),d=0==p?0:(m-o)/1e3;0===p&&(a=h,o=m),r+=y?parseFloat(y):0;var v=r/(p+1);g[1].position.cartographicDegrees.push(d),g[1].position.cartographicDegrees.push(u),g[1].position.cartographicDegrees.push(f),g[1].position.cartographicDegrees.push(y?parseFloat(y):v),p==c.length-1&&(g[0].clock.interval=a+"/"+h,g[1].availability=a+"/"+h)}"function"==typeof e&&e(!1,g)}catch(t){"function"==typeof e&&e(!0,t.toString())}}};"undefined"!=typeof exports?module.exports=t:window.gpx2czml=t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdweDJjem1sLmpzIl0sIm5hbWVzIjpbIkZpbGVSZWFkZXIiLCJwcm90b3R5cGUiLCJyZWFkQXNCaW5hcnlTdHJpbmciLCJmaWxlRGF0YSIsImJpbmFyeSIsInB0IiwidGhpcyIsInJlYWRlciIsIm9ubG9hZCIsImUiLCJieXRlcyIsIlVpbnQ4QXJyYXkiLCJyZXN1bHQiLCJsZW5ndGgiLCJieXRlTGVuZ3RoIiwiaSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImNvbnRlbnQiLCIkIiwidHJpZ2dlciIsInJlYWRBc0FycmF5QnVmZmVyIiwiZ3B4MmN6bWwiLCJhc3luYyIsInVybCIsImNiRnVuYyIsImdldEdweERhdGEiLCJodHRwUmVxdWVzdCIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJzZWxmIiwicGFyc2VHcHgiLCJyZXNwb25zZVRleHQiLCJpc0Vycm9yIiwicmVzIiwid2luZG93IiwiWE1MSHR0cFJlcXVlc3QiLCJBY3RpdmVYT2JqZWN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwib3BlbiIsInNlbmQiLCJhc3luY0Zyb21GaWxlIiwiZmlsZXMiLCJwcm9jZXNzaW5nRmlsZXMiLCJjem1sRXJyb3IiLCJjem1sUmVzIiwiYnJvd3NlciIsInRhcmdldCIsImRhdGEiLCJyZWFkQXNUZXh0IiwidG9TdHJpbmciLCJ0bXAiLCJ4bWwiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJsb2FkWE1MIiwiZ3B4Tm9kZSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiYmluZEN6bWxEYXRhIiwiY3ptbERhdGEiLCJnZXRUZXh0VGFnIiwidGFnIiwidGFnU3RyIiwidGV4dENvbnRlbnQiLCJyZXBsYWNlIiwic3VtRWxlIiwic3RhcnRUaW1lIiwic3RhcnRTZWNvbmRzIiwidHJrQ29udGVudCIsInRya1NlZyIsInRya1B0cyIsIm5hbWUiLCJnZXRBdHRyaWJ1dGUiLCJ2ZXJzaW9uIiwiY2xvY2siLCJpbnRlcnZhbCIsImN1cnJlbnRUaW1lIiwibXVsdGlwbGllciIsInJhbmdlIiwicG9zaXRpb24iLCJlcG9jaCIsImNhcnRvZ3JhcGhpY0RlZ3JlZXMiLCJpZHgiLCJ0cmtJbmZvIiwibGF0IiwicGFyc2VGbG9hdCIsImxvbiIsImVsZSIsInRpbWUiLCJ0YXJnZXRTZWNvbmRzIiwiRGF0ZSIsImdldFRpbWUiLCJkZWZmU2Vjb25kcyIsImF2Z0VsZSIsInB1c2giLCJhdmFpbGFiaWxpdHkiLCJleHBvcnRzIiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUVBLFdBQ09BLFdBQVdDLFVBQVVDLHFCQUN4QkYsV0FBV0MsVUFBVUMsbUJBQXFCLFNBQVVDLEdBQ2xELEdBQUlDLEdBQVMsR0FDVEMsRUFBS0MsS0FDTEMsRUFBUyxHQUFJUCxXQUNqQk8sR0FBT0MsT0FBUyxTQUFVQyxHQUd4QixJQUFLLEdBRkRDLEdBQVEsR0FBSUMsWUFBV0osRUFBT0ssUUFDOUJDLEVBQVNILEVBQU1JLFdBQ1ZDLEVBQUksRUFBR0EsRUFBSUYsRUFBUUUsSUFDMUJYLEdBQVVZLE9BQU9DLGFBQWFQLEVBQU1LLEdBR3RDVixHQUFHYSxRQUFVZCxFQUNiZSxFQUFFZCxHQUFJZSxRQUFRLFdBRWhCYixFQUFPYyxrQkFBa0JsQixJQUk3QixJQUFJbUIsSUFDRkMsTUFBUSxTQUFVQyxFQUFLQyxHQWNyQixRQUFTQyxLQUN3QixJQUEzQkMsRUFBWUMsYUFDYSxNQUF2QkQsRUFBWUUsT0FDZEMsRUFBS0MsU0FBU0osRUFBWUssYUFBYyxTQUFVQyxFQUFTQyxHQUN0QyxrQkFBVlQsSUFBd0JBLEVBQU9RLEVBQVNDLEtBR2xDLGtCQUFWVCxJQUF3QkEsR0FBTyxFQUFNLHVCQXBCbEQsR0FBSUUsR0FDQUcsRUFBT3hCLElBRVA2QixRQUFPQyxlQUNUVCxFQUFjLEdBQUlTLGdCQUNURCxPQUFPRSxnQkFDaEJWLEVBQWMsR0FBSVUsZUFBYyxzQkFHbENWLEVBQVlXLG1CQUFxQlosRUFDakNDLEVBQVlZLEtBQUssTUFBT2YsR0FDeEJHLEVBQVlhLFFBa0JkQyxjQUFnQixTQUFVQyxFQUFPakIsR0FD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b0JhLEtBQUtWLEdBQzlDekIsRUFBUyxHQUFHb0IsU0FBU0Usb0JBQW9CYSxLQUFLUCxFQUFLRixXQUFXRSxHQUFPTSxHQUVqRVgsR0FBUVosRUFBT3pELE9BQVEsSUFDekI4QyxFQUFTLEdBQUdlLE1BQU1DLFNBQVdULEVBQVksSUFBTXNCLEVBQy9DN0IsRUFBUyxHQUFHb0MsYUFBZTdCLEVBQVksSUFBTXNCLEdBSWhDLGtCQUFWL0QsSUFBd0JBLEdBQU8sRUFBT2tDLEdBQzdDLE1BQU9sRCxHQUNVLGtCQUFWZ0IsSUFBd0JBLEdBQU8sRUFBTWhCLEVBQUV5QyxjQUs3QixvQkFBWjhDLFNBQ1RDLE9BQU9ELFFBQVUxRSxFQUVqQmEsT0FBT2IsU0FBV0EiLCJmaWxlIjoiZ3B4MmN6bWwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICBpZiAoIUZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZykge1xuICAgIEZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChmaWxlRGF0YSkge1xuICAgICAgdmFyIGJpbmFyeSA9IFwiXCI7XG4gICAgICB2YXIgcHQgPSB0aGlzO1xuICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocmVhZGVyLnJlc3VsdCk7XG4gICAgICAgIHZhciBsZW5ndGggPSBieXRlcy5ieXRlTGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgICAgLy9wdC5yZXN1bHQgIC0gcmVhZG9ubHkgc28gYXNzaWduIGJpbmFyeVxuICAgICAgICBwdC5jb250ZW50ID0gYmluYXJ5O1xuICAgICAgICAkKHB0KS50cmlnZ2VyKCdvbmxvYWQnKTtcbiAgICAgIH1cbiAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlRGF0YSk7XG4gICAgfTtcbiAgfVxuXG4gIHZhciBncHgyY3ptbCA9IHtcbiAgICBhc3luYyA6IGZ1bmN0aW9uICh1cmwsIGNiRnVuYykge1xuICAgICAgdmFyIGh0dHBSZXF1ZXN0O1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICB9IGVsc2UgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7XG4gICAgICAgIGh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MSFRUUFwiKTtcbiAgICAgIH1cblxuICAgICAgaHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZ2V0R3B4RGF0YTtcbiAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG5cbiAgICAgIGZ1bmN0aW9uIGdldEdweERhdGEoKSB7XG4gICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBzZWxmLnBhcnNlR3B4KGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dCwgZnVuY3Rpb24gKGlzRXJyb3IsIHJlcykge1xuICAgICAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhpc0Vycm9yLCByZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCAnaHR0cCByZXF1ZXN0IGVycm9yJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBncHggZmlsZSB1cGxvYWQg7ZSE66Gc7IS47IuxIOyymOumrChhc3luYylcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGZpbGVzIGZpbGUgT2JqZWN0XG4gICAgICovXG4gICAgYXN5bmNGcm9tRmlsZSA6IGZ1bmN0aW9uIChmaWxlcywgY2JGdW5jKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZ0ZpbGVzKGZpbGVzLCBmdW5jdGlvbiAoaXNFcnJvciwgcmVzKSB7XG5cbiAgICAgICAgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmMoaXNFcnJvciwgcmVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLnBhcnNlR3B4KHJlcywgZnVuY3Rpb24gKGN6bWxFcnJvciwgY3ptbFJlcykge1xuICAgICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGN6bWxFcnJvciwgY3ptbFJlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBncHggZmlsZSBvYmplY3Qg7ZSE66Gc7IS47IuxIOyymOumrFxuICAgICAqIEBwYXJhbSAge09iamVjdH0gZmlsZXMgZmlsZSBPYmplY3RcbiAgICAgKi9cbiAgICBwcm9jZXNzaW5nRmlsZXMgOiBmdW5jdGlvbiAoZSwgY2JGdW5jKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHZhciBicm93c2VyID0gJ2Nocm9tZSc7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciBkYXRhO1xuICAgICAgICAgIGlmICghZSkge1xuICAgICAgICAgICAgZGF0YSA9IHJlYWRlci5jb250ZW50O1xuICAgICAgICAgICAgYnJvd3NlciA9ICdpZSc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGZhbHNlLCBkYXRhKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlc1swXSwgJ1VURi04Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgXCJmaWxlIGlzIG5vdCBkZWZpbmVkXCI7XG4gICAgICAgIH1cblxuICAgICAgICAvL2ZpbGXsnYQg7J296rKMIO2VnOuLpC5cbiAgICAgICAgLy9yZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGVzWzBdKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKHRydWUsIGUudG9TdHJpbmcoKSk7XG4gICAgICB9XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogcGFyc2luZyBncHggZGF0YVxuICAgICAqIEBwYXJhbSAge1N0cmluZ30gZGF0YSBwZ3ggc3RyaW5nIGRhdGFcbiAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2JGdW5jIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjb252ZXJ0IGN6bWwgb2JqZWN0IGRhdGFcbiAgICAgKi9cbiAgICBwYXJzZUdweCA6IGZ1bmN0aW9uIChkYXRhLCBjYkZ1bmMpIHtcbiAgICAgIHZhciB0bXAseG1sO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvL2lmIERPTVBhcnNlciBpcyBleGlzdFxuICAgICAgICBpZiAod2luZG93LkRPTVBhcnNlcikge1xuICAgICAgICAgIHRtcCA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICB4bWwgPSB0bXAucGFyc2VGcm9tU3RyaW5nKCBkYXRhLCBcInRleHQveG1sXCIgKTtcbiAgICAgICAgfSBlbHNlIHsgIC8vSUUgdmVyc2lvblxuICAgICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcbiAgICAgICAgICB4bWwuYXN5bmMgPSBcImZhbHNlXCI7XG4gICAgICAgICAgeG1sLmxvYWRYTUwoZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2dldCBncHggbm9kZSBmcm9tIHhtbCBkYXRhXG4gICAgICAgIHZhciBncHhOb2RlID0geG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdncHgnKVswXTtcblxuICAgICAgICAvL2JpbmQgY3ptbGRhdGFcbiAgICAgICAgdGhpcy5iaW5kQ3ptbERhdGEoZ3B4Tm9kZSwgZnVuY3Rpb24gKGlzRXJyb3IsIGN6bWxEYXRhKSB7XG4gICAgICAgICAgdHlwZW9mIGNiRnVuYyA9PSBcImZ1bmN0aW9uXCIgJiYgY2JGdW5jKGlzRXJyb3IsIGN6bWxEYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyh0cnVlLCBlLnRvU3RyaW5nKCkpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBnZXQgdGV4dCBmcm9tIHRhZ1xuICAgICAqIEBwYXJhbSAge1N0cmluZ30gdGFnIHRhZyBzdHJpbmdcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRhZ1N0ciB0YWcgc3RyaW5nXG4gICAgICovXG4gICAgZ2V0VGV4dFRhZyA6IGZ1bmN0aW9uICh0YWcpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB0YWdTdHIgPSB0YWcudGV4dENvbnRlbnQ7XG4gICAgICAgIHRhZ1N0ci5yZXBsYWNlKC8oXlxccyopfChcXHMqJCkvZ2ksIFwiXCIpO1xuXG4gICAgICAgIHJldHVybiB0YWdTdHI7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBjem1sIGRhdGEgYmluZGluZ1xuICAgICAqIEBwYXJhbSAge09iamVjdH0gZ3B4Tm9kZSBncHggeG1sIGRvbSBub2RlXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBjem1sRGF0YSBjem1sIG9iamVjdCBkYXRhXG4gICAgICovXG4gICAgYmluZEN6bWxEYXRhIDogZnVuY3Rpb24gKGdweE5vZGUsIGNiRnVuYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHN1bUVsZSA9IDA7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8veG1sIHBhcnNpbmdcbiAgICAgICAgdmFyIG1ldGFEYXRhID0gZ3B4Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWV0YWRhdGEnKVswXSwgLy9tZXRhZGF0YVxuICAgICAgICAgICAgdHJrQ29udGVudCA9IGdweE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyaycpWzBdLCAgLy90cmFja2luZyBkYXRhXG4gICAgICAgICAgICB0cmtTZWcgPSB0cmtDb250ZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cmtzZWcnKVswXSwgIC8vdHJrc2VnXG4gICAgICAgICAgICB0cmtQdHMgPSB0cmtTZWcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rya3B0Jyk7ICAvL3RyYWNraW5nIHBvaW50IGFycmF5c1xuXG4gICAgICAgIC8vZ2V0IHN0YXJ0IHRpbWVcbiAgICAgICAgdmFyIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIHN0YXJ0U2Vjb25kcztcblxuICAgICAgICAvL2JpbmRpbmcgdGFyZ2V0XG4gICAgICAgIHZhciBjem1sRGF0YSA9IFt7XG4gICAgICAgICAgbmFtZSA6IGdweE5vZGUuZ2V0QXR0cmlidXRlKCdjcmVhdG9yJyksXG4gICAgICAgICAgdmVyc2lvbiA6IGdweE5vZGUuZ2V0QXR0cmlidXRlKCd2ZXJzaW9uJyksXG4gICAgICAgICAgY2xvY2sgOiB7XG4gICAgICAgICAgICBpbnRlcnZhbCA6IG51bGwsXG4gICAgICAgICAgICBjdXJyZW50VGltZSA6IHN0YXJ0VGltZSxcbiAgICAgICAgICAgIG11bHRpcGxpZXIgOiAxLFxuICAgICAgICAgICAgcmFuZ2UgOiAnQ0xBTVBFRCdcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBwb3NpdGlvbiA6IHtcbiAgICAgICAgICAgIGVwb2NoIDogc3RhcnRUaW1lLFxuICAgICAgICAgICAgY2FydG9ncmFwaGljRGVncmVlcyA6IFtdXG4gICAgICAgICAgfVxuICAgICAgICB9XTtcblxuICAgICAgICAvL3NldCBjYXJ0b2dyYXBoaWNEZWdyZWVzIGluZm9cbiAgICAgICAgZm9yKHZhciBpZHg9MDsgaWR4IDwgdHJrUHRzLmxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICB2YXIgdHJrSW5mbyA9IHRya1B0c1tpZHhdLFxuICAgICAgICAgICAgICBsYXQgPSBwYXJzZUZsb2F0KHRya0luZm8uZ2V0QXR0cmlidXRlKCdsYXQnKSksICAvL2xhdGl0dWRlXG4gICAgICAgICAgICAgIGxvbiA9IHBhcnNlRmxvYXQodHJrSW5mby5nZXRBdHRyaWJ1dGUoJ2xvbicpKSwgIC8vbG9uZ2l0dWRlXG4gICAgICAgICAgICAgIGVsZSA9IHNlbGYuZ2V0VGV4dFRhZyh0cmtJbmZvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdlbGUnKVswXSksICAvL2VsZVxuICAgICAgICAgICAgICB0aW1lID0gc2VsZi5nZXRUZXh0VGFnKHRya0luZm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpbWUnKVswXSksICAvL2ludGVydmFsIHRpbWVcbiAgICAgICAgICAgICAgdGFyZ2V0U2Vjb25kcyA9IG5ldyBEYXRlKHRpbWUpLmdldFRpbWUoKSwgLy9pbnRlcnZhbCB0aW1lIGZyb20gc3RhcnRTZWNvbmRzXG4gICAgICAgICAgICAgIGRlZmZTZWNvbmRzID0gKGlkeCA9PSAwPyAwIDogKCh0YXJnZXRTZWNvbmRzIC0gc3RhcnRTZWNvbmRzKSAvIDEwMDApKTsgIC8vY29udmVydCBzZWNvbmRcblxuICAgICAgICAgIGlmIChpZHggPT09IDApIHtcbiAgICAgICAgICAgIHN0YXJ0VGltZSA9IHRpbWU7XG4gICAgICAgICAgICBzdGFydFNlY29uZHMgPSB0YXJnZXRTZWNvbmRzO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vZWxlIGludGVycG9sYXRlXG4gICAgICAgICAgc3VtRWxlICs9IChlbGU/cGFyc2VGbG9hdChlbGUpIDogMCk7XG5cbiAgICAgICAgICB2YXIgYXZnRWxlID0gc3VtRWxlIC8gKGlkeCsxKTtcblxuICAgICAgICAgIGN6bWxEYXRhWzFdLnBvc2l0aW9uLmNhcnRvZ3JhcGhpY0RlZ3JlZXMucHVzaChkZWZmU2Vjb25kcyk7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxvbik7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGxhdCk7XG4gICAgICAgICAgY3ptbERhdGFbMV0ucG9zaXRpb24uY2FydG9ncmFwaGljRGVncmVlcy5wdXNoKGVsZT8gcGFyc2VGbG9hdChlbGUpIDogYXZnRWxlKTtcblxuICAgICAgICAgIGlmIChpZHggPT0gKHRya1B0cy5sZW5ndGggLTEpKSB7XG4gICAgICAgICAgICBjem1sRGF0YVswXS5jbG9jay5pbnRlcnZhbCA9IHN0YXJ0VGltZSArICcvJyArIHRpbWU7XG4gICAgICAgICAgICBjem1sRGF0YVsxXS5hdmFpbGFiaWxpdHkgPSBzdGFydFRpbWUgKyAnLycgKyB0aW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHR5cGVvZiBjYkZ1bmMgPT0gXCJmdW5jdGlvblwiICYmIGNiRnVuYyhmYWxzZSwgY3ptbERhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0eXBlb2YgY2JGdW5jID09IFwiZnVuY3Rpb25cIiAmJiBjYkZ1bmModHJ1ZSwgZS50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZ3B4MmN6bWw7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmdweDJjem1sID0gZ3B4MmN6bWw7XG4gIH1cbn0pKCk7XG4iXX0=
