"use strict";!function(){FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var t="",n=this,r=new FileReader;r.onload=function(e){for(var a=new Uint8Array(r.result),o=a.byteLength,i=0;i<o;i++)t+=String.fromCharCode(a[i]);n.content=t,$(n).trigger("onload")},r.readAsArrayBuffer(e)});var e={async:function(e,t){function n(){4===r.readyState&&(200===r.status?a.parseGpx(r.responseText,function(e,n){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(!0,"http request error"))}var r,a=this;window.XMLHttpRequest?r=new XMLHttpRequest:window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP")),r.onreadystatechange=n,r.open("GET",e),r.send()},asyncFromFile:function(e,t){var n=this;this.processingFiles(e,function(e,r){e?"function"==typeof t&&t(e,r):n.parseGpx(r,function(e,n){"function"==typeof t&&t(e,n)})})},processingFiles:function(e,t){var n=new FileReader,r="chrome";try{var a=e.target.files;if(n.onload=function(e){var a;e?a=e.target.result:(a=n.content,r="ie"),"function"==typeof t&&t(!1,a)},!(a.length>0))throw"file is not defined";n.readAsText(a[0],"UTF-8")}catch(e){"function"==typeof t&&t(!0,e.toString())}},parseGpx:function(e,t){var n,r;try{window.DOMParser?(n=new DOMParser,r=n.parseFromString(e,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e));var a=r.getElementsByTagName("gpx")[0];this.bindCzmlData(a,function(e,n){"function"==typeof t&&t(e,n)})}catch(e){"function"==typeof t&&t(!0,e.toString())}},getTextTag:function(e){try{var t=e.textContent;return t.replace(/(^\s*)|(\s*$)/gi,""),t}catch(e){return null}},bindCzmlData:function(e,t){var n=this;try{for(var r,a,o,i=(e.getElementsByTagName("metadata")[0],e.getElementsByTagName("trk")[0]),s=i.getElementsByTagName("trkseg")[0],c=(s.childNodes,s.getElementsByTagName("trkpt")),g=[{name:e.getAttribute("creator"),version:e.getAttribute("version"),clock:{interval:null,currentTime:r,multiplier:1,range:"CLAMPED"}},{position:{epoch:r,cartographicDegrees:[]}}],l=0;l<c.length;l++){var p=c[l],f=parseFloat(p.getAttribute("lat")),u=parseFloat(p.getAttribute("lon")),y=n.getTextTag(p.getElementsByTagName("ele")[0]),m=n.getTextTag(p.getElementsByTagName("time")[0]),h=new Date(m).getTime(),d=0==l?0:(h-a)/1e3;if(0===l&&(r=m,a=h),y)o=parseFloat(y);else for(var T=c[l+1],v=T?n.getTextTag(T.getElementsByTagName("ele")[0]):null,w=0;w<c.length;w++){var x=c[w],F=n.getTextTag(x.getElementsByTagName("ele")[0]);if(F){o=parseFloat(F);break}}g[1].position.cartographicDegrees.push(d),g[1].position.cartographicDegrees.push(u),g[1].position.cartographicDegrees.push(f),g[1].position.cartographicDegrees.push(y?parseFloat(y):v?(o+parseFloat(v))/2:o),l==c.length-1&&(g[0].clock.interval=r+"/"+m,g[0].clock.currentTime=r,g[1].availability=r+"/"+m,g[1].position.epoch=r)}"function"==typeof t&&t(!1,g)}catch(e){"function"==typeof t&&t(!0,e.toString())}}};"undefined"!=typeof exports?module.exports=e:window.gpx2czml=e}();